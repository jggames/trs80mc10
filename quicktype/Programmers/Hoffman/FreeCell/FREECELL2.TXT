0 CLS:CLEAR500:DIMCC,ZZ,C1,C2,C3,M$,M:M=16384:GOTO50
1 C2=1:C1=32:FORC1=C1TOC2STEP-1:I$=MID$(M$,C1,1):IFI$<"!"THEN?MID$(M$,C2,C1-C2):C2=C1+1:C1=C2+32:IFI$=""THENC1=.
2 C1=C1+(C1>255)*(C1-255):NEXT:M$="":RETURN
REM INPUT 2 NUMBERS C1 & C2 OUTPUT C3 (MODULUS)
REM REM INPUT C1,C2
3 C3=C1-(C2*INT(C1/C2)):RETURN
7 C1=(PEEK(17024)AND1)*256+PEEK(17025)-1+M:FORC2=1TOLEN(M$):C3=ASC(MID$(M$,C2)):POKEC1+C2,C3-(C3AND64):NEXT:?@C1-M+C2,:RETURN

50 PRINT"freecell FOR MICRO COLOR BASIC":PRINT
99 REM THE FOLLOWING ARE ALL SHARED VARIABLES
100 DIMC$(13,4),OK$(12):REM CARD IMAGES
110 DIMGP(18,8,2):REM GAME POSITIONS
120 DIMF(4,2):REM 4 SUPPLEMENTARY
130 DIMT(4):REM 4 REPLACEMENTS
140 DIMD1,D2:REM START,DESTINATION VARS
150 PRINT"DO YOU NEED INSTRUCTIONS? (Y/N)":INPUTM$
160 IFM$="Y"ORM$="YES"THENGOSUB2000

200 CLS:PRINT@0,;:M$="10  11  12  13 ":GOSUB7:PRINT@32*2,;:M$="1   2   3   4   5   6   7   8   ":GOSUB7
210 GOSUB7000:REM INIT
220 GOSUB6000:REM DEAL
230 GOSUB1000:REM DISPLAY CARDS
250 GOSUB5000:REM DEMANDE
260 GOSUB3000:REM CALCUL
270 GOSUB1000:REM REFRESH DISPLAY OF CARDS
280 GOSUB4000:REM CALCULTAS
290 IFNOT(T(1)+T(2)+T(3)+T(4)=52)THEN250
300 PRINT@16,"* * * WIN * * *";
310 PRINT
320 END

999 REM SUB AFFICHE
1000 PRINT@16,"":PRINT@480,"                               ";
1020 FORCC=1TO18:FORZZ=1TO8:IFCC>10THENPRINT@32*15+(ZZ-1)*4,C$(GP(CC,ZZ,1),GP(CC,ZZ,2));:GOTO1140
1030 PRINT@32*(CC+2)+(ZZ-1)*4,C$(GP(CC,ZZ,1),GP(CC,ZZ,2))
1140 NEXTZZ:NEXTCC
1200 FORCC=1TO4:PRINT@32+(CC-1)*4,C$(F(CC,1),F(CC,2))
1260 NEXTCC
1270 FORCC=1TO4:PRINT@32+(CC-1)*4+16,C$(T(CC),CC)
1340 NEXTCC
1998 RETURN

1999 REM SUB HELP
2000 CLS:PRINT"freecell help":PRINT
2020 M$="THE OBJECT OF THIS GAME IS TO PLACE THE CARDS BY SUIT IN THEIR HOLDER AT THE TOP RIGHT.":GOSUB1
2030 M$="TO DO THIS, YOU MUST FORM COLUMNS WHERE THE CONSECUTIVE CARDS FOLLOW EACH OTHER.":GOSUB1
2040 M$="THE COLUMNS MUST BE ORDERED IN A DESCENDING WAY WITH ALTERNATE RED/ORANGE AND BLUE/CYAN SUITS.":GOSUB1:GOSUB2200
2050 CLS:PRINT"freecell help":PRINT:M$="THE BOXES AT THE TOP LEFT ARE A RESERVE OF SPACES.":GOSUB1
2060 M$="TO MOVE A CARD FROM PILE 1 TO PILE 3, TYPE 1.3":GOSUB1
2070 M$="AVAILABLE CARDS GO UP AUTOMATICALLY INTO THEIR HOLDER.":GOSUB1
2080 GOSUB2200:CLS:GOTO2998
2200 PRINT@448,;:M$="PRESS A KEY":GOSUB7
2210 M$=INKEY$:IFM$=""THEN2210
2998 RETURN

2999 REM SUB CALCUL
3000 OK=0:REM INPUT ERROR FLAG
3010 IFD2>8THEN3200
3020 GOTO3500   
3200 IFF(D2-9,1)=0THEN3300
3210 GOTO3990              
3300 IFD1>8THENF(D1-9,1)>0THENOK=1:F(D2-9,1)=F(D1-9,1):F(D2-9,2)=F(D1-9,2):F(D1-9,1)=0:F(D1-9,2)=0:GOTO3990
3400 I=0
3410 I=I+1:IFGP(I,D1,1)THEN3410
3420 OK=1:F(D2-9,1)=GP(I-1,D1,1):F(D2-9,2)=GP(I-1,D1,2):GP(I-1,D1,1)=0:GP(I-1,D1,2)=0
3499 GOTO3990
3500 IFD1>8THEN3510
3501 GOTO3600
3510 K0=0:IFF(D1-9,1)<=0THEN3990
3530 N1=F(D1-9,1):S1=F(D1-9,2):I=19
3540 I=I-1:IFGP(I,D2,1)>0ORI=1THEN3550
3541 GOTO3540
3550 IFGP(I,D2,1)=N1+1THENIFABS(  (S1MOD2)  -  (GP(I,D2,2)MOD2)   )=1THENK0=1:GOTO3560
3551 GOTO3990
3560 IFGP(I,D2,1)=0ORK0=1THEN3570
3561 GOTO3990
3570 OK=1:IFGP(I,D2,1)=0THENI=0:GP(I+1,D2,1)=F(D1-9,1):GP(I+1,D2,2)=F(D1-9,2):F(D1-9,1)=0:F(D1-9,2)=0
3590 GOTO3990
3600 IFGP(1,D2,1)=0THEN3610
3601 GOTO3800
REM                '*** DEPUIS UNE COLONNE VERS UNE COLONNE VIDE ********
3610 I=19:K0=1:I0=0
3620 I=I-1:IFI0>0THEN3630
3621 GOTO3650
3630 IFGP(I,D1,1)=GP(I+1,D1,1)+1THENIFABS(  (GP(I+1,D1,2)-GP(I,D1,2))MOD2   )=1THENK0=1:GOTO3640
3631 K0=0
3640 IFI0=0THENIFGP(I,D1,1)>0THENI0=I
3650 IFI=1ORGP(I,D1,1)=N2-1ORK0=0:GOTO3990
3651 GOTO3620
REM                        IF K0=0 THEN I1=I+1 ELSE I1=I
REM                        N1=GP(I1, D1, 1)
REM                        S1=GP(I1, D1, 2)
REM                        GOSUB8000
REM                        IF I0 - I1+1 <= PO THEN PO=I0 - I1+1
REM                        FOR I=1 TO PO
REM                                OK=1
REM                                GP(I2+I, D2, 1)=GP(I0 - PO+I, D1, 1)
REM                                GP(I2+I, D2, 2)=GP(I0 - PO+I, D1, 2)
REM                                GP(I0 - PO+I, D1, 1)=0
REM                                GP(I0 - PO+I, D1, 2)=0
REM                        NEXT I
3799 GOTO3990
REM                        '*** DEPUIS UNE COLONNE VERS UNE COLONNE NON VIDE ********
3800                       I=19
REM                        DO
REM                                I=I - 1
REM                        LOOP UNTIL GP(I, D2, 1) > 0
REM                        I2=I
REM                        N2=GP(I2, D2, 1)
REM                        S2=GP(I2, D2, 2)
REM                        I=19
REM                        I0=0
REM                        K0=1
REM                        DO
REM                                I=I - 1
REM                                IF I0 > 0 THEN
REM                                        IF GP(I, D1, 1)=GP(I+1, D1, 1)+1 AND ABS((GP(I+1, D1, 2) - GP(I, D1, 2)) MOD 2)=1 THEN K0=1 ELSE K0=0
REM                                END IF
REM                                IF I0=0 AND GP(I, D1, 1) > 0 THEN I0=I
REM                        LOOP UNTIL I=1 OR GP(I, D1, 1)=N2 - 1 OR K0=0
REM                        IF GP(I, D1, 1)=N2 - 1 AND ABS(S2 MOD 2 - GP(I, D1, 2) MOD 2)=1 THEN K0=K0+1
REM                        IF K0=2 THEN
REM                                I1=I
REM                                N1=GP(I1, D1, 1)
REM                                S1=GP(I1, D1, 2)
REM                                IF I0 - I1+1 > 1 THEN
REM                                        GOSUB8000
REM                                        IF PO >= I0 - I1+1 THEN O0=1
REM                                ELSE
REM                                        O0=1
REM                                END IF
REM                                IF O0=1 THEN
REM                                        FOR I=1 TO I0 - I1+1
REM                                                OK=1
REM                                                GP(I2+I, D2, 1)=GP(I1+I - 1, D1, 1)
REM                                                GP(I2+I, D2, 2)=GP(I1+I - 1, D1, 2)
REM                                                GP(I1+I - 1, D1, 1)=0
REM                                                GP(I1+I - 1, D1, 2)=0
REM                                        NEXT I
REM                                END IF
REM                        END IF
3990 IFOK=0THENPRINT@16,"":PRINT@16,"error"
3998 RETURN

3999 REM SUB CALCULTAS
4000 OK=0
4010 FORI=1TO8
4020 IFGP(1,I,1)<=0THEN4190
4030 J=19
4040 J=J-1
4070 IFGP(J,I,1)<=0THEN4040
4080 FORK=1TO4
4090 NU=T(K)
4100 IFGP(J,I,1)=NU+1THENIFGP(J,I,2)=KTHEN4110
4101 GOTO4170
4110 OK=1
4120 T(K)=NU+1
4130 GP(J,I,1)=0
4140 GP(J,I,2)=0
4150 GOSUB1000
4170 NEXTK
4190 NEXTI
4200 FORI=1TO4
4210 FORK=1TO4
4220 NU=T(K)
4430 IFF(I,1)=NU+1THENIFF(I,2)=KTHEN4440
4431 GOTO4490
4440 OK=1
4450 T(K)=NU+1
4460 F(I,1)=0
4470 F(I,2)=0
4480 GOSUB1000
4490 NEXTK
4500 NEXTI
4990 IFOKTHEN4000
4998 RETURN

4999 REM SUB DEMANDE
5000 OK=0:REM CHECK FOR 2 NUMBERS
5060 PRINT@16,"":PRINT@16,;:INPUTDE$
5070 XX=0:ZZ=LEN(DE$):FORCC=1TOZZ:IFMID$(DE$,CC,1)="."THENXX=CC
5071 NEXTCC
5080 IFXX=0THEN5500
5090 D1$=LEFT$(DE$,XX-1)
5100 D2$=RIGHT$(DE$,LEN(DE$)-XX)
5110 FORCC=1TO12
5120 IFD1$=OK$(CC)THENOK=OK+1
5130 IFD2$=OK$(CC)THENOK=OK+1
5140 NEXTCC
5500 IFOK<2ANDXX>0THENPRINT@16,"":PRINT@16,"ERROR":SOUND1,10
5510 IFOK<>2THEN5060
5520 D1=VAL(D1$):D2=VAL(D2$)
5530 REM PRINTD1,D2:STOP
5998 RETURN

5999 REM DEAL
6000 PRINT@16,"SHUFFLING...";:FORI=5TO8
6010 GP(7,I,1)=1:GP(7,I,2)=1
6020 NEXTI
6030 I=RND(-(PEEK(9)*256+PEEK(10))):REM RANDOMIZE TIMER
6040 FORNU=1TO13
6050 FORSI=1TO4
6060 X=RND(8):Y=RND(7):IFGP(Y,X,1)THEN6060
6090 GP(Y,X,1)=NU
6100 GP(Y,X,2)=SI
6110 NEXTSI:NEXTNU
6120 FORI=5TO8
6130 GP(7,I,1)=0:GP(7,I,2)=0
6140 NEXTI
6998 RETURN

6999 REM SUB INIT
7000 FORNU=1TO13:REM NUM DE LA CARTE
7010 FORSI=1TO4:REM SYMBOLE DE LA CARTE
7020 IFNU>=1ORNU<=9THENA$=MID$(STR$(NU),2,1)
7030 IFNU=10THENA$="T"
7040 IFNU=11THENA$="J"
7050 IFNU=12THENA$="Q"
7060 IFNU=13THENA$="K"
7070 IFSI=1THENB$="÷ò"
7080 IFSI=2THENB$="×Ò"
7090 IFSI=3THENB$="¹¸"
7100 IFSI=4THENB$="­¨"
7110 C$(NU,SI)=A$+B$
7120 NEXTSI:NEXTNU
7130 FORCC=1TO18
7140 FORZZ=1TO8
7150 GP(CC,ZZ,1)=0
7160 GP(CC,ZZ,2)=0
7170 NEXTZZ
7180 NEXTCC
7200 FORCC=1TO12
7210 IFCC>8THENZZ=CC+1:GOTO7230
7220 ZZ=CC
7230 OK$(CC)=MID$(STR$(ZZ),2)
7240 NEXTCC
7998 RETURN

7999 REM FUNCTION VALDEPL (D2)
8000 FR=0:FORCC=1TO4:IFF(CC,1)=0THENFR=FR+1
8030 NEXTCC
8040 GA=0:REM NO OF FREE COLUMNS
8050 FORCC=1TO8:IFGP(1,CC,1)=0THENIFCC<>D2THENGA=GA+1
8070 NEXTCC
8080 PO=0:FORCC=GATO0STEP-1:PO=PO+CC+FR:NEXTCC
8130 PO=PO+1:RETURN

REM SUB AIDE () 2000
REM SUB CALCULTAS () 4000
REM SUB CALCUL () 3000
REM SUB DEMANDE () 5000
REM SUB AFFICHE () 1000
REM SUB DEAL () 6000
REM SUB INIT () 7000
REM FUNCTION VALDEPL! (D2!) 8000
