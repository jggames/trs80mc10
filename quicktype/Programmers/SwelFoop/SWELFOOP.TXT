1000 REM SWELL FOOP FOR VIDEOPAC+ (PHILLIPS O2EM)
1010 REM BY GERTK(AT)XS4ALL.NL
1020 REM CLEAR SCREEN, DISABLE TOP LINE
1030 INIT 0
1040 PRINTCHR$(150);
1050 STORE
1060 TX 2,3,0
1070 PRINT "VVIIDDEEOOPPAACC  ";
1080 PRINT "CC77442200"
1090 PRINT "VVIIDDEEOOPPAACC  ";
1100 PRINT "CC77442200"
1110 TX 3,3,0
1120 PRINT
1130 PRINT
1140 PRINT "SSWWEELLLL  FFOOOOPP"
1150 PRINT "SSWWEELLLL  FFOOOOPP"
1160 PRINT
1170 PRINT
1180 TX 4,0,0
1190 PRINT "(C)2012 GERTK@XS4ALL.NL";
1200 DISPLAY:SCREEN
1210 FOR T=1 TO 2000:NEXT T
1220 INIT 0
1230 PRINTCHR$(150);
1240 STORE
1250 TX 7,0,0
1260 PRINT "SWELL FOOP IS A PUZZLE ";
1270 PRINT "GAME."
1280 PRINT
1290 PRINT "THE GOAL IS TO REMOVE";
1300 PRINT " AS MANY OBJECTS"
1310 PRINT "AS POSSIBLE IN ";
1320 PRINT "AS FEW MOVES AS"
1330 PRINT "POSSIBLE."
1340 PRINT "OBJECTS ADJACENT TO EACH";
1350 PRINT " OTHER GET"
1360 PRINT "REMOVED AS A GROUP."
1370 PRINT "THE REMAINING OBJECTS";
1380 PRINT " THEN COLLAPSE"
1390 PRINT "TO FILL IN THE GAPS AND";
1400 PRINT " NEW GROUPS ARE"
1410 PRINT "FORMED."
1420 PRINT "YOU CANNOT REMOVE SINGLE";
1430 PRINT " OBJECTS."
1440 PRINT
1450 TX 2,0,0
1460 PRINT "PRESS BUTTON TO START.."
1470 DISPLAY:SCREEN
1480 GOSUB 3570
1490 REM RESET SCORE
1500 SC=0
1510 REM BOARD DIMENSIONS AND NR. OF COLORS
1520 MX=15:MY=10:NC=4
1530 REM DEFINE GRAPHICS CHARACTERS
1540 SETET 37,"00FEFEFEFEFEFEFEFEFE"
1550 SETET 38,"00412214080814224100"
1560 DIM BD(MX,MY)
1570 REM PSEUDO STACK FOR SEARCH
1580 DIM SX(MX*MY),SY(MX*MY)
1590 REM FILL ARRAY 
1600 FOR X=0 TO MX
1610 FOR Y=0 TO MY
1620 BD(X,Y)=1+INT(RND(1)*NC)
1630 NEXT Y
1640 NEXT X
1650 PY=MY:PX=0
1660 EX=MX
1670 INIT 4
1680 PRINTCHR$(150);
1690 REM MAIN LOOP
1700 GOSUB 3010
1710 GOSUB 3210
1720 SOUND 6
1730 STORE
1740 MD=1:DX=PX:DY=PY:GOSUB 2840
1750 SCREEN:DISPLAY
1760 REM WAIT FOR JOYSTICK MOVEMENT
1770 JS=ACTION(0):IF JS=0 THEN 1770
1780 REM ACTION BUTTON PRESSED
1790 IF JS AND 1 THEN 1940
1800 STORE
1810 MD=0:DX=PX:DY=PY:GOSUB 2840
1820 SCREEN:DISPLAY
1830 REM CHECK DIRECTIONAL MOVEMENT
1840 IF JS AND 8 THEN PY=PY+1
1850 IF PY>MY THEN PY=MY
1860 IF JS AND 16 THEN PY=PY-1
1870 IF PY<0 THEN PY=0
1880 IF JS AND 2 THEN PX=PX+1
1890 IF PX>MX THEN PX=MX
1900 IF JS AND 4 THEN PX=PX-1
1910 IF PX<0 THEN PX=0
1920 GOTO 1730
1930 REM ACTION !
1940 FC=BD(PX,PY)
1950 REM CHECK FOR EMPTY SPACE
1960 IF FC=0 THEN SOUND 5:GOTO 1730
1970 REM SET SEARCH COORDINATES
1980 FX=PX:FY=PY
1990 REM RESET YIELD
2000 YD=0
2010 STORE
2020 GOSUB 2230
2030 SOUND 1
2040 REM SHOW YIELD IN DOUBLE HEIGHT
2050 TX 7,1,0
2060 CURSORY 10:CURSORX 33
2070 PRINT"YIELD:";
2080 CURSORY 11:CURSORX 33
2090 PRINT"YIELD:";
2100 CURSORY 12:CURSORX 33
2110 PRINT STR$(YD);"  ";
2120 CURSORY 13:CURSORX 33
2130 PRINT STR$(YD);"  ";
2140 REM FORCE SCREEN UPDATE AND REDRAW
2150 DISPLAY:SCREEN
2160 REM CHECK FALL OR SWOOP
2170 GOSUB 2350
2180 REM CALCULATE SCORE
2190 IF YD<2 THEN SOUND 8:GOTO 1730
2200 SC=SC+(YD-2)^2
2210 GOTO 1700
2220 REM SEARCH START
2230 SP=0
2240 REM SEARCHLOOP
2250 X=FX+1:Y=FY:GOSUB 2730
2260 X=FX-1:Y=FY:GOSUB 2730
2270 X=FX:Y=FY-1:GOSUB 2730
2280 X=FX:Y=FY+1:GOSUB 2730
2290 REM IF NO ADJACENT PIECES FOUND
2300 IF SP=0 THEN RETURN
2310 REM GET NEXT COORDINATES FROM STACK
2320 FX=SX(SP):FY=SY(SP):SP=SP-1
2330 GOTO 2250
2340 REM SWOOP OR FALL
2350 FOR X=0 TO EX
2360 Y=MY
2370 CC=0
2380 IF BD(X,Y)=0 THEN 2430
2390 IF CC>0 THEN 2450
2400 Y=Y-1
2410 IF Y<0 THEN 2530
2420 GOTO 2380
2430 CC=CC+1
2440 GOTO 2400
2450 FOR Z=Y TO 0 STEP -1
2460 BD(X,Z+CC)=BD(X,Z)
2470 NEXT Z
2480 Y=Y+CC
2490 CC=CC-1
2500 BD(X,CC)=0
2510 IF CC=0 THEN 2400
2520 GOTO 2490
2530 NEXT X
2540 REM CHECK FOR EMPTY COLUMNS
2550 X=0
2560 IF BD(X,MY) THEN 2690
2570 IF X>EX THEN 2710
2580 FOR S=X TO EX-1
2590 FOR T=0 TO MY
2600 BD(S,T)=BD(S+1,T)
2610 NEXT T
2620 NEXT S
2630 FOR T=0 TO MY
2640 BD(EX,T)=0
2650 NEXT T
2660 EX=EX-1
2670 IF EX<0 THEN 2710
2680 GOTO 2560
2690 X=X+1
2700 IF X<EX THEN 2560
2710 RETURN
2720 REM CHECK LIMITS AND PIECE FOR COLOR
2730 IF Y>MY OR Y<0 THEN RETURN
2740 IF X>EX OR X<0 THEN RETURN
2750 IF BD(X,Y)<>FC THEN RETURN
2760 REM FOUND SAME COLOR, PUSH ON STACK
2770 SP=SP+1:SX(SP)=X:SY(SP)=Y
2780 DX=X:DY=Y:MD=1:GOSUB 2840
2790 BD(X,Y)=0
2800 REM INCREASE YIELD COUNTER
2810 YD=YD+1
2820 RETURN
2830 REM DISPLAY WHITE CROSS IF EMPTY
2840 IF BD(DX,DY) OR MD=0 THEN 2920
2850 ET 7,3,MD
2860 CURSORX DX*2+1:CURSORY DY*2
2870 PRINT"&&";
2880 CURSORX DX*2+1:CURSORY DY*2+1
2890 PRINT"&&";
2900 RETURN
2910 REM DISPLAY SINGLE PIECE
2920 DC=BD(DX,DY)
2930 IF DC>3 THEN DC=DC+1
2940 ET DC,3,MD
2950 CURSORX DX*2+1:CURSORY DY*2
2960 PRINT"%%";
2970 CURSORX DX*2+1:CURSORY DY*2+1
2980 PRINT"%%";
2990 RETURN
3000 REM DRAW BOARD
3010 STORE
3020 REM DISPLAY SCORE
3030 CURSORY 0:CURSORX 33
3040 TX 6,1,0
3050 PRINT"SCORE:";
3060 CURSORY 1:CURSORX 33
3070 PRINT"SCORE:";
3080 CURSORY 2:CURSORX 33
3090 PRINT STR$(SC);
3100 CURSORY 3:CURSORX 33
3110 PRINT STR$(SC);
3120 REM DRAW ALL PIECES IN MODE 0
3130 MD=0
3140 FOR DY=0 TO MY
3150 FOR DX=0 TO MX
3160 GOSUB 2920
3170 NEXT DX
3180 NEXT DY
3190 DISPLAY:SCREEN
3200 RETURN
3210 X=0
3220 Y=MY
3230 C=0
3240 IF BD(X,Y)=0 THEN 3300
3250 GOSUB 3340
3260 IF C>0 THEN RETURN
3270 Y=Y-1
3280 IF Y>=0 THEN 3230
3290 GOTO 3310
3300 IF X=0 AND Y=MY THEN 3420
3310 X=X+1
3320 IF X>EX THEN 3430
3330 GOTO 3220
3340 FC=BD(X,Y)
3350 IF (X+1)>EX THEN 3370
3360 IF BD(X+1,Y)=FC THEN 3400
3370 IF (Y-1)<0 THEN 3390
3380 IF BD(X,Y-1)=FC THEN 3400
3390 RETURN
3400 C=C+1
3410 RETURN
3420 SC=SC+1000
3430 STORE
3440 TX 6,1,0
3450 CURSORY 2:CURSORX 33
3460 PRINT STR$(SC);
3470 CURSORY 3:CURSORX 33
3480 PRINT STR$(SC);
3490 TX 7,3,1
3500 CURSORY 4:CURSORX 7
3510 PRINT "GGAAMMEE  OOVVEERR";
3520 CURSORY 5:CURSORX 7
3530 PRINT "GGAAMMEE  OOVVEERR";
3540 DISPLAY:SCREEN
3550 GOSUB 3570
3560 RUN 1490
3570 JS=ACTION(0)
3580 IF JS<>0 THEN 3570
3590 JS=ACTION(0)
3600 IF (JS AND 1)=0 THEN 3590
3610 RETURN
3620 END
