5 MC=16384:REM CLEAR SCREEN AND PRINT HEADING
10 GOSUB 2400
20 PRINT "  **************************************"
30 PRINT "  * LABYRINTH (C) DON SCALES, JAN 1980 *"
35 PRINT "  *    CONVERTED FOR R-PI TINYBASIC    *"
36 PRINT "  *         A.F.LACK, DEC 2012         *"
40 PRINT "  **************************************"
45 REM GET MAZE DIMENSION
50 PRINT "ENTER SIZE OF MAZE"
60 INPUT "WIDTH? "; H: INPUT "HEIGHT? "; V
70 PRINT "THINKING..."
95 REM CLEAR MAZE ARRAY
100 A=H*V+1:DIMA(A+A)
110 FOR I=1 TO A+A:A(I)=0: NEXT I
120 Q=0:Z=0:X=RND(H)
125 REM-SAVE MAZE ENTRY POINT
130 A(A)=X
140 A(X)=1: C=2
150 R=X: S=1: GOTO 220
155 REM START OF MAZE BUILD ROUTINE
160 IF R<>H GOTO 200
170 IF S<>V GOTO 190
180 R=1: S=1: GOTO 210
190 R=1: S=S+1: GOTO 210
200 R=R+1
210 IF A(R+(S-1)*H)=0 GOTO 160
220 IF R-1=0 GOTO 610
230 IF A(R-1+(S-1)*H)<>0 GOTO 610
240 IF S-1=0 GOTO 420
250 IF A(R+(S-2)*H)<>0 GOTO 420
260 IF R=H GOTO 320
270 IF A(R+1+(S-1)*H)<>0 GOTO 320
275 REM-LEFT/DOWN/RIGHT
280 X=RND(3)
290 IF X=1 GOTO 960
300 IF X=2 GOTO 1000
310 GOTO 1040
320 IF S<>V GOTO 350
330 IF Z=1 GOTO 400
340 Q=1: GOTO 360
350 IF A(R+S*H)<>0 GOTO 400
355 REM-LEFT/DOWN/UP
360 X=RND(3)
370 IF X=1 GOTO 960
380 IF X=2 GOTO 1000
390 GOTO 1110
395 REM-LEFT/DOWN
400 X=RND(2)
410 GOTO 370
420 IF R=H GOTO 540
430 IF A(R+1+(S-1)*H)<>0 GOTO 540
440 IF S<>V GOTO 470
450 IF Z=1 GOTO 520
460 Q=1: GOTO 480
470 IF A(R+S*H)<>0 GOTO 520
475 REM LEFT/RIGHT/UP
480 X=RND(3)
490 IF X=1 GOTO 960
500 IF X=2 GOTO 1040
510 GOTO 1110
515 REM-LEFT/RIGHT
520 X=RND(2)
530 GOTO 490
540 IF S<>V GOTO 570
550 IF Z=1 GOTO 960
560 Q=1: GOTO 580
570 IF A(R+S*H)<>0 GOTO 960
575 REM-LEFT/UP
580 X=RND(2)
590 IF X=1 GOTO 960
600 GOTO 1110
610 IF S-1=0 GOTO 820
620 IF A(R+(S-2)*H)<>0 GOTO 820
630 IF R=H GOTO 750
640 IF A(R+1+(S-1)*H)<>0 GOTO 750
650 IF S<>V GOTO 680
660 IF Z=1 GOTO 730
670 Q=1: GOTO 690
680 IF A(R+S*H)<>0 GOTO 730
685 REM-DOWN/RIGHT/UP
690 X=RND(3)
700 IF X=1 GOTO 1000
710 IF X=2 GOTO 1040
720 GOTO 1110
725 REM-DOWN/RIGHT
730 X=RND(2)
740 GOTO 700
750 IF S<>V GOTO 780
760 IF Z=1 GOTO 1000
770 Q=1: GOTO 790
780 IF A(R+S*H)<>0 GOTO 1000
785 REM-DOWN/UP
790 X=RND(2)
800 IF X=1 GOTO 1000
810 GOTO 1110
820 IF R=H GOTO 910
830 IF A(R+1+(S-1)*H)<>0 GOTO 910
840 IF S<>V GOTO 870
850 IF Z=1 GOTO 1040
860 Q=1: GOTO 880
870 IF A(R+S*H)<>0 GOTO 1040
875 REM-RIGHT/UP
880 X=RND(2)
890 IF X=1 GOTO 1040
900 GOTO 1110
910 IF S<>V GOTO 940
920 IF Z=1 GOTO 160
930 Q=1: GOTO 950
940 IF A(R+S*H)<>0 GOTO 160
950 GOTO 1110
955 REM-LEFT
960 A(R-1+(S-1)*H)=C
970 C=C+1: A(A+R-1+(S-1)*H)=2: R=R-1
980 IF C=A GOTO 1210
990 Q=0: GOTO 220
995 REM-DOWN
1000 A(R+(S-2)*H)=C
1010 C=C+1
1020 A(A+R+(S-2)*H)=1: S=S-1: IF C=A GOTO 1210
1030 Q=0: GOTO 220
1035 REM-RIGHT
1040 A(R+1+(S-1)*H)=C
1050 C=C+1: IF A(A+R+(S-1)*H)=0 GOTO 1070
1060 A(A+R+(S-1)*H)=3: GOTO 1080
1070 A(A+R+(S-1)*H)=2
1080 R=R+1
1090 IF C=A GOTO 1210
1100 GOTO 610
1105 REM-UP
1110 IF Q=1 GOTO 1170
1120 A(R+S*H)=C: C=C+1: IF A(A+R+(S-1)*H)=0 GOTO 1140
1130 A(A+R+(S-1)*H)=3: GOTO 1150
1140 A(A+R+(S-1)*H)=1
1150 S=S+1: IF C=A GOTO 1210
1160 GOTO 220
1165 REM-EXIT AT TOP OF SCREEN
1170 Z=1
1180 IF A(A+R+(S-1)*H)=0 GOTO 1200
1190 A(A+R+(S-1)*H)=3: Q=0: GOTO 160
1200 A(A+R+(S-1)*H)=1: Q=0: R=1: S=1: GOTO 210
1205 REM-MAKE EXIT IF NOT THERE
1210 IF Z<>1 X=A+RND(H)+(V-1)*H: A(X)=A(X)+1
1295 REM-END OF MAZE BUILD
1300 PRINT "DO YOU WANT TO SEE THE MAZE?",
1310 WAIT KEY::I: REM WAIT FOR ANY KEY
1320 IF (I<>121)*(I<>89) GOTO 1630
1330 GOSUB 2400: PRINT "CHEAT!!!!"
1335 REM-2D DISPLAY ROUTINE
1340 FOR J=V TO 1 STEP -1
1350 FOR I=1 TO H
1360 IF A(A+I+(J-1)*H)=0 GOTO 1400
1370 IF A(A+I+(J-1)*H)=2 GOTO 1400
1375 REM-PRINT TOP OF CELLS
1380 PRINT "+  ";
1390 GOTO 1410
1400 PRINT "+--";
1410 NEXT I
1420 PRINT "+"
1430 PRINT "I";
1440 FOR I=1 TO H
1450 IF A(A+I+(J-1)*H)<2 GOTO 1480
1455 REM-PRINT SIDES OF CELLS
1460 PRINT "   ";
1470 GOTO 1490
1480 PRINT "  I";
1490 NEXT I
1500 PRINT
1510 NEXT J
1520 FOR I=1 TO H
1530 IF I=A(A) GOTO 1550
1535 REM PRINT BOTTOM OF MAZE
1540 PRINT "+--";: GOTO 1560
1550 PRINT "+  ";
1560 NEXT I
1570 PRINT "+"
1595 REM-PAUSE FOR VIEWING
1600 GOSUB 2450
1610 PRINT "PRESS ANY KEY WHEN READY...";
1620 WAIT KEY
1625 REM-PRINT INSTRUCTION
1630 GOSUB 1900
1635 REM TRANSLATE ROUTINE
1640 FOR I=1 TO A-1
1650 J=I+A
1660 A(I)=(3-A(J))*2
1670 NEXT I
1710 W=A(A)
1715 REM-COMPLETE CELL INFORMATION
1720 FOR J=1 TO V
1730 K=(J-1)*H
1740 FOR I=1 TO H
1750 L=I+K
1760 IF J<>1 GOTO 1790
1770 IF I=W GOTO 1820
1780 M=1: GOTO 1810
1790 M=A(L-H)/2
1800 M=M-(M/2)*2
1810 A(L)=A(L)+M*8
1820 IF I=1 M=1: GOTO 1850
1830 M=A(L-1)/4
1840 M=M-(M/2)*2
1850 A(L)=A(L)+M
1860 NEXT I
1870 NEXT J
1875 REM SET UP START PARAMS
1880 X=W: Y=0: Z=1
1890 GOTO 3050
1895 REM INSTRUCTION PRINTOUT
1900 GOSUB 2400
1910 PRINT "ENTER L TO TURN LEFT"
1920 PRINT "      R TO TURN RIGHT"
1930 PRINT "      F TO GO FORWARD"
1940 PRINT "      H FOR HELP"
1950 PRINT "      Q TO GIVE UP!"
1960 RETURN
1995 REM HELP ROUTINE
2000 PRINT@0,"YOU ARE AT "; 
2010 PRINT@0,X,"  EAST";
2020 PRINT@0,Y,"  NORTH";
2030 PRINT@0,"YOU ARE FACING";
2040 IF Z=1 PRINT "NORTH";
2050 IF Z=2 PRINT "EAST";
2060 IF Z=3 PRINT "SOUTH";
2070 IF Z=4 PRINT "WEST";
2080 POKEMC+O+0,29: POKEMC+O+0,10
2090 GOSUB 2450
2100 GOTO 2200
2195 REM KEYBOARD ROUTINE
2200 IF Y>V GOTO 5000
2210 WAIT KEY,,A
2220 REM
2230 IF A=108 GOTO 2300
2240 IF A=114 GOTO 2350
2250 IF A=102 GOTO 3000
2260 IF A=104 GOTO 2000
2270 IF A=113 STOP
2280 GOTO 2210
2295 REM LEFT TURN
2300 Z=Z-1
2310 IF Z<1 Z=Z+4
2320 GOTO 3050
2345 REM RIGHT TURN
2350 Z=Z+1
2360 IF Z>4 Z=Z-4
2370 GOTO 3050
2395 REM-CLEAR SCREEN
2400 CLS
2410 RETURN
2445 REM-RESET/HOME CURSOR
2450 PRINT@0,;
2460 RETURN
2495 REM ERASE MESSAGE ROUTINE
2500 GOSUB 2860
2510 PRINT "                             "
2520 GOSUB 2450
2530 S=0
2540 RETURN
2595 REM ROTATE AND LOOK ROUTINE
2600 IF B=0 GOTO 2710
2610 IF B>V THEN E=2: RETURN
2620 F=A(A+(B-1)*H)
2630 IF Z=1 GOTO 2670
2635 REM ROTATE
2640 FOR I=2 TO Z
2650 F=F/2+(F-(F/2)*2)*8
2660 NEXT I
2670 C=F-(F/2)*2
2680 D=F/4-(F/8)*2
2690 E=F/2-(F/4)*2
2700 RETURN
2705 REM OUTSIDE MAZE
2710 C=0, D=0, E=-1
2720 IF Z<>1 GOTO 2760
2730 E=1
2740 IF A=W E=0
2750 RETURN
2755 REM NO MAN"S LAND
2760 IF Z=3 E=2
2770 IF Z=2 IF A=H E=2
2780 IF Z=4 IF A=1 E=2
2790 RETURN
2795 REM INDEX TO THE NEXT CELL
2800 IF E>0 GOTO 2930
2810 IF Z=1 B=B+1
2820 IF Z=2 A=A+1
2830 IF Z=3 B=B-1
2840 IF Z=4 A=A-1
2850 RETURN
2855 REM MESSAGE ROUTINE
2860 FOR I=1 TO 8
2870 POKEMC+O+0,10
2880 NEXT I
2890 FOR I=1 TO 23
2900 POKEMC+O+0,9
2910 NEXT I
2920 RETURN
2930 GOSUB 2860
2940 IF E=1 PRINT "  DEAD END   ",
2950 IF E=2 PRINT "NO MANS LAND",
2960 GOSUB 2450
2970 S=1
2980 RETURN
2995 REM FORWARD ROUTINE
3000 A=X, B=Y
3010 GOSUB 2600
3020 GOSUB 2800
3030 X=A, Y=B
3040 IF E>0 GOTO 2200
3045 REM 3D DISPLAY ROUTINE
3050 A=X, B=Y
3060 GOSUB 2600
3065 REM 5 DEPTHS
3070 FOR T=1 TO 5
3080 GOSUB 3200
3085 REM CHECK FOR NEXT DEPTH
3090 IF E<>0 GOTO 2200
3100 GOSUB 2800
3110 GOSUB 2600
3120 IF E=2 GOTO 2200
3130 NEXT T
3140 GOTO 2200
3195 REM JUMP TO DISPLAY DEPTH
3200 GOTO T*400+2810
3205 REM DISPLAY DEPTH 1
3210 GOSUB 2400
3220 IF E<0 RETURN
3230 IF E>1 RETURN
3240 FOR I=80 TO 976 STEP 64
3250 POKEMC+O+I,116
3260 POKEMC+O+I+28,116
3270 NEXT I
3280 IF E=0 RETURN
3290 FOR I=81 TO 107
3300 POKEMC+O+I,107
3310 POKEMC+O+I+896,108
3320 NEXT I
3330 RETURN
3600 REM DISPLAY DEPTH 2
3610 IF C=0 GOTO 3690
3620 POKEMC+O+81,114
3630 POKEMC+O+147,114
3640 POKEMC+O+213,114
3650 POKEMC+O+977,113
3660 POKEMC+O+915,113
3670 POKEMC+O+853,113
3680 GOTO 3730
3690 FOR I=273 TO 277
3700 POKEMC+O+I,107
3710 POKEMC+O+I+512,108
3720 NEXT I
3730 IF D=0 GOTO 3810
3740 POKEMC+O+107,113
3750 POKEMC+O+169,113
3760 POKEMC+O+231,113
3770 POKEMC+O+1003,114
3780 POKEMC+O+937,114
3790 POKEMC+O+871,114
3800 GOTO 3850
3810 FOR I=295 TO 299
3820 POKEMC+O+I,107
3830 POKEMC+O+I+512,108
3840 NEXT I
3850 FOR I=278 TO 790 STEP 64
3860 POKEMC+O+I,116
3870 POKEMC+O+I+16,116
3880 NEXT I
3890 IF E=0 RETURN
3900 FOR I=279 TO 293
3910 POKEMC+O+I,107
3920 POKEMC+O+I+512,108
3930 NEXT I
3940 RETURN
4000 REM DISPLAY DEPTH 3
4010 IF C=0 GOTO 4070
4020 POKEMC+O+279,114
4030 POKEMC+O+345,114
4040 POKEMC+O+791,113
4050 POKEMC+O+729,113
4060 GOTO 4110
4070 FOR I=407 TO 409
4080 POKEMC+O+I,107
4090 POKEMC+O+I+256,108
4100 NEXT I
4110 IF D=0 GOTO 4170
4120 POKEMC+O+293,113
4130 POKEMC+O+355,113
4140 POKEMC+O+805,114
4150 POKEMC+O+739,114
4160 GOTO 4210
4170 FOR I=419 TO 421
4180 POKEMC+O+I,107
4190 POKEMC+O+I+256,108
4200 NEXT I
4210 FOR I=410 TO 666 STEP 64
4220 POKEMC+O+I,116
4230 POKEMC+O+I+8,116
4240 NEXT I
4250 IF E=0 RETURN
4260 FOR I=411 TO 417
4270 POKEMC+O+I,107
4280 POKEMC+O+I+256,108
4290 NEXT I
4300 RETURN
4400 REM DISPLAY DEPTH 4
4410 IF C=0 GOTO 4450
4420 POKEMC+O+411,114
4430 POKEMC+O+667,113
4440 GOTO 4470
4450 POKEMC+O+475,107
4460 POKEMC+O+603,108
4470 IF D=0 GOTO 4510
4480 POKEMC+O+417,113
4490 POKEMC+O+673,114
4500 GOTO 4530
4510 POKEMC+O+481,107
4520 POKEMC+O+609,108
4530 FOR I=476 TO 604 STEP 64
4540 POKEMC+O+I,116
4550 POKEMC+O+I+4,116
4560 NEXT I
4570 IF E=0 RETURN
4580 FOR I=477 TO 479
4590 POKEMC+O+I,107
4600 POKEMC+O+I+128,108
4610 NEXT I
4620 RETURN
4800 REM DISPLAY DEPTH 5
4810 IF C=0 GOTO 4850
4820 POKEMC+O+477,114
4830 POKEMC+O+605,113
4840 GOTO 4870
4850 POKEMC+O+477,108
4860 POKEMC+O+605,107
4870 IF D=0 GOTO 4910
4880 POKEMC+O+479,113
4890 POKEMC+O+607,114
4900 GOTO 4930
4910 POKEMC+O+479,108
4920 POKEMC+O+607,107
4930 POKEMC+O+541,106
4940 POKEMC+O+543,105
4950 IF E=0 RETURN
4960 POKEMC+O+478,108
4970 POKEMC+O+606,107
4980 RETURN
4995 REM WAY OUT FOUND
5000 GOSUB 2400
5010 GOSUB 2860
5020 PRINT "  WAY OUT"
5030 STOP
