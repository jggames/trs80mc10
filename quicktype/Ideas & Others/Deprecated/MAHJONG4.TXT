0 CLS5:PRINT@203,"MAHJONG V2";:DIM T(36,3),D(144),TR(16,9,5),CL(5),I$
1 DIM X,Y,L,TQ,UF,TP,MC,RC,TT,T1,T2,XX,YY,ML,V1,V2,V3,V4,N1,N2,N3,N4,N5,C,T,P,N,Z
2 GOSUB100:GOSUB300:GOSUB400:GOTO900
5 TQ=(Y*64)+(X*2)-66
6 IF (X<2ORX>13)AND(Y>3ANDY<6)THENTQ=TQ-V2
7 IF (Y=4ORY=5)AND(X=7ORX=8)ANDTR(X,Y,0)=5THENTQ=237
8 RETURN
10 GOSUB5:L=TR(X,Y,Z)
11 PRINT@TQ,CHR$(T(TR(X,Y,L),Z)+(CL(L)*V1));CHR$(T(TR(X,Y,L),N1)+(CL(L)*V1));
12 PRINT@TQ+V2,CHR$(T(TR(X,Y,L),N2)+(CL(L)*V1));CHR$(T(TR(X,Y,L),N3)+(CL(L)*V1));:RETURN
13 GOSUB5:T(Z,Z)=PEEK(MC+TQ):T(Z,N1)=PEEK(MC+N1+TQ):T(Z,N2)=PEEK(MC+V2+TQ):T(Z,N3)=PEEK(MC+V3+TQ):RETURN
15 PRINT@TQ,CHR$(UF);CHR$(UF);:PRINT@TQ+32,CHR$(UF);CHR$(UF);:RETURN
17 POKEMC+TQ,T(Z,Z):POKEMC+TQ+N1,T(Z,N1):POKEMC+TQ+V2,T(Z,N2):POKEMC+TQ+V3,T(Z,N3):RETURN
20 R=RND(144):T=D(R):IFT=ZTHEN20
25 D(R)=Z:TR(X,Y,L)=T:TR(X,Y,Z)=TR(X,Y,Z)+N1:RETURN
30 FORML=N1TO64000:I$=INKEY$:IFI$=""THEN40
31 IFI$=" "ORI$=CHR$(13)THENGOSUB800:RC=0:GOTO40
33 IFI$="W"THENIFY>1THENGOSUB17:Y=Y-1:GOSUB13:RC=0:GOTO40
34 IFI$="Z"THENIFY<8THENGOSUB17:Y=Y+1:GOSUB13:RC=0:GOTO40
36 IFI$="S"THENIFX<15THENGOSUB17:X=X+1:GOSUB13:RC=0:GOTO40
38 IFI$="A"THENIFX>1THENGOSUB17:X=X-1:GOSUB13:RC=0:GOTO40
40 RC=RC+1:IFRC<TTTHENGOSUB15:GOTO70
50 IFRC>TT+TTTHENRC=Z
60 GOSUB17
70 NEXTML:END
100 TQ=0:C=1:MC=16384:TT=7:Z=0:V1=16:V2=32:V3=33:V4=64:N1=1:N2=2:N3=3:N4=4:N5=5:UF=191
110 FORT=0TO35:FORY=0TO3:FORX=0TO3
120 READP:IFPTHENRESET(XX+X,YY+Y):RESET(63-(XX+X),31-(YY+Y))
130 NEXTX,Y
132 T(C,0)=PEEK(MC+TQ):T(C,1)=PEEK(MC+1+TQ)
133 T(C,2)=PEEK(MC+32+TQ):T(C,3)=PEEK(MC+33+TQ)
140 C=C+1:TQ=TQ+2:XX=XX+4:RC=RC+1:IFRC=16THENRC=0:TQ=TQ+32:XX=0:YY=YY+4
145 NEXTT
160 PRINT@TQ+33+96,"PLEASE WAIT...";
190 RETURN
300 T=1:CL(1)=0:CL(2)=1:CL(3)=2:CL(4)=3:CL(5)=-3
310 FORC=1TO4:FORY=1TO9:D(T)=Y:T=T+1:NEXTY,C
320 FORC=1TO4:FORY=10TO18:D(T)=Y:T=T+1:NEXTY,C
330 FORC=1TO4:FORY=19TO27:D(T)=Y:T=T+1:NEXTY,C
340 FORC=1TO4:FORY=28TO36:D(T)=Y:T=T+1:NEXTY,C
350 RETURN
400 FORL=1TO4:FORY=1TO8:FORX=1TO15
430 READP:ONPGOSUB20
440 NEXTX,Y,L
450 CLS:FORL=1TO4:FORY=1TO8:FORX=1TO15:READP:ONPGOSUB10
455 NEXTX,Y,L
460 L=5:X=8:Y=5:FOR R=1 TO 144:T=D(R):IFT<>0THENTR(X,Y,L)=T:TR(X,Y,0)=TR(X,Y,0)+1:D(R)=0:R=144:GOSUB10
465 NEXT
470 X=8:Y=4:TR(X,Y,L)=T:TR(X,Y,0)=5:X=7:Y=4:TR(X,Y,L)=T:TR(X,Y,0)=5:X=7:Y=5:TR(X,Y,L)=T:TR(X,Y,0)=5
490 RETURN
600 TP=-1:FORY=4TO5:FORX=7TO8:TR(X,Y,0)=4:GOSUB10:NEXTX,Y:RETURN
800 IFTR(X,Y,0)=0THEN840
805 IFUF=175THEN810
807 IF(TR(X-1,Y,TR(X,Y,0))=0 OR TR(X+1,Y,TR(X,Y,0))=0)THEN809
808 GOTO810
809 UF=175:T1=TR(X,Y,TR(X,Y,0)):XX=X:YY=Y:LL=TR(X,Y,0):QQ=TQ:PRINT@64,"#1";:GOTO840
810 T2=TR(X,Y,TR(X,Y,0))
820 IFT1=T2 AND (TR(X-1,Y,TR(X,Y,0))=0 OR TR(X+1,Y,TR(X,Y,0))=0) AND TQ<>QQ THENGOSUB860
830 UF=191:GOSUB890
840 RETURN
860 PRINT@96,"#2";:SOUND200,1:XC=X:YC=Y:LC=TR(X,Y,0):QC=TQ:TR(X,Y,TR(X,Y,0))=0
865 TR(X,Y,0)=TR(X,Y,0)-1:IFTR(X,Y,0)=4THENGOSUB600:GOTO870
867 IFTR(X,Y,0)>0THENGOSUB10:GOSUB13:GOTO870
869 GOSUB5:PRINT@TQ,"  ";:PRINT@TQ+32,"  ";:GOSUB13
870 SOUND200,1:X=XX:Y=YY:TR(X,Y,0)=LL:TQ=QQ:TR(X,Y,TR(X,Y,0))=0
871 TR(X,Y,0)=TR(X,Y,0)-1:IFTR(X,Y,0)=4THENGOSUB600:GOTO875
872 IFTR(X,Y,0)>0THENGOSUB10:GOTO875
873 PRINT@TQ,"  ";:PRINT@TQ+32,"  ";
875 X=XC:Y=YC:TR(X,Y,0)=LC-1:GOSUB13:TC=TC-2:IFTC=0THENSOUND200,5:PRINT@377," YOU ";:PRINT@409," WIN! ";:GOTO890
880 PRINT@377,"TILES";:PRINT@409,TC;
890 PRINT@64,"  ";:PRINT@96,"  ";:RETURN
899 REM INIT
900 L=1:Y=1:X=7:TC=144:RC=0
910 PRINT@88,"MAHJONG";:PRINT@88+32,"  BY";:PRINT@88+64," JIM G";
920 GOSUB880
930 C=53:FORT=352TO480STEP32:POKEMC+T+1,C+64::PRINT@T,CHR$(207+(16*CL(C-48)));:C=C-1:NEXTT
990 GOSUB13:GOSUB17:GOTO30
1001 DATA 0,0,0,0
1002 DATA 0,1,0,0
1003 DATA 0,0,0,0
1004 DATA 0,0,0,0
1005 REM  ********
1011 DATA 1,0,0,0
1012 DATA 0,0,0,0
1013 DATA 0,0,1,0
1014 DATA 0,0,0,0
1015 REM  ********
1021 DATA 1,0,0,0
1022 DATA 0,1,0,0
1023 DATA 0,0,1,0
1024 DATA 0,0,0,0
1025 REM  ********
1031 DATA 1,0,1,0
1032 DATA 0,0,0,0
1033 DATA 1,0,1,0
1034 DATA 0,0,0,0
1035 REM  ********
1041 DATA 1,0,1,0
1042 DATA 0,1,0,0
1043 DATA 1,0,1,0
1044 DATA 0,0,0,0
1045 REM  ********
1046 DATA 1,0,1,0
1047 DATA 1,0,1,0
1048 DATA 1,0,1,0
1049 DATA 0,0,0,0
1050 REM  ********
1051 DATA 0,1,0,0
1052 DATA 1,1,1,0
1053 DATA 1,1,1,0
1054 DATA 0,0,0,0
1065 REM  ********
1061 DATA 1,1,1,0
1062 DATA 1,0,1,0
1063 DATA 1,1,1,0
1064 DATA 0,0,0,0
1065 REM  ********
1071 DATA 1,1,1,0
1072 DATA 1,1,1,0
1073 DATA 1,1,1,0
1074 DATA 0,0,0,0
1075 REM  ********
2000 REM SET 2
2001 DATA 0,1,0,0
2002 DATA 0,1,0,0
2003 DATA 0,1,0,0
2004 DATA 0,0,0,0
2005 REM  ********
2011 DATA 0,1,0,0
2012 DATA 1,1,1,0
2013 DATA 0,1,0,0
2014 DATA 0,0,0,0
2015 REM  ********
2021 DATA 0,1,0,0
2022 DATA 1,1,1,0
2023 DATA 1,0,1,0
2024 DATA 0,0,0,0
2025 REM  ********
2031 DATA 1,1,1,0
2032 DATA 0,0,0,0
2033 DATA 1,1,1,0
2034 DATA 0,0,0,0
2035 REM  ********
2041 DATA 1,1,1,0
2042 DATA 0,1,0,0
2043 DATA 1,1,1,0
2044 DATA 0,0,0,0
2045 REM  ********
2046 DATA 1,0,1,0
2047 DATA 1,1,1,0
2048 DATA 1,0,1,0
2049 DATA 0,0,0,0
2050 REM  ********
2051 DATA 1,0,1,0
2052 DATA 1,0,1,0
2053 DATA 1,1,1,0
2054 DATA 0,0,0,0
2065 REM  ********
2061 DATA 1,0,1,0
2062 DATA 1,1,1,0
2063 DATA 0,1,0,0
2064 DATA 0,0,0,0
2065 REM  ********
2071 DATA 0,1,1,0
2072 DATA 0,1,0,0
2073 DATA 1,1,0,0
2074 DATA 0,0,0,0
2075 REM  ********
3000 REM SET 3
3001 DATA 0,1,0,0
3002 DATA 0,1,0,0
3003 DATA 1,1,1,0
3004 DATA 0,0,0,0
3005 REM  ********
3011 DATA 0,0,0,0
3012 DATA 1,1,1,0
3013 DATA 0,0,0,0
3014 DATA 0,0,0,0
3015 REM  ********
3021 DATA 0,0,1,0
3022 DATA 0,0,1,0
3023 DATA 1,1,1,0
3024 DATA 0,0,0,0
3025 REM  ********
3031 DATA 1,1,1,0
3032 DATA 1,0,0,0
3033 DATA 1,0,0,0
3034 DATA 0,0,0,0
3035 REM  ********
3041 DATA 1,1,1,0
3042 DATA 0,0,1,0
3043 DATA 0,0,1,0
3044 DATA 0,0,0,0
3045 REM  ********
3046 DATA 1,0,0,0
3047 DATA 1,0,0,0
3048 DATA 1,1,1,0
3049 DATA 0,0,0,0
3050 REM  ********
3051 DATA 1,1,1,0
3052 DATA 0,1,0,0
3053 DATA 0,1,0,0
3054 DATA 0,0,0,0
3065 REM  ********
3061 DATA 0,0,1,0
3062 DATA 1,1,1,0
3063 DATA 0,0,1,0
3064 DATA 0,0,0,0
3065 REM  ********
3071 DATA 1,0,0,0
3072 DATA 1,1,1,0
3073 DATA 1,0,0,0
3074 DATA 0,0,0,0
3075 REM  ********
4000 REM SET 4
4001 DATA 0,0,0,0
4002 DATA 0,1,1,0
4003 DATA 0,1,1,0
4004 DATA 0,0,0,0
4005 REM  ********
4011 DATA 1,1,0,0
4012 DATA 1,1,1,0
4013 DATA 0,1,1,0
4014 DATA 0,0,0,0
4015 REM  ********
4021 DATA 0,1,0,0
4022 DATA 1,0,1,0
4023 DATA 0,1,0,0
4024 DATA 0,0,0,0
4025 REM  ********
4031 DATA 1,1,1,0
4032 DATA 1,1,0,0
4033 DATA 1,0,0,0
4034 DATA 0,0,0,0
4035 REM  ********
4041 DATA 0,0,1,0
4042 DATA 0,1,1,0
4043 DATA 1,1,1,0
4044 DATA 0,0,0,0
4045 REM  ********
4046 DATA 0,1,0,0
4047 DATA 0,1,0,0
4048 DATA 1,0,1,0
4049 DATA 0,0,0,0
4050 REM  ********
4051 DATA 1,1,1,0
4052 DATA 0,1,1,0
4053 DATA 0,0,1,0
4054 DATA 0,0,0,0
4065 REM  ********
4061 DATA 1,0,0,0
4062 DATA 1,1,0,0
4063 DATA 1,1,1,0
4064 DATA 0,0,0,0
4065 REM  ********
4071 DATA 1,1,0,0
4072 DATA 1,0,1,0
4073 DATA 0,1,1,0
4074 DATA 0,0,0,0
4075 REM  ********
5000 REM TURTLE 1
5001 DATA 0,1,1,1,1,1,1,1,1,1,1,1,1,0,0
5002 DATA 0,0,0,1,1,1,1,1,1,1,1,0,0,0,0
5003 DATA 0,0,1,1,1,1,1,1,1,1,1,1,0,0,0
5004 DATA 0,1,1,1,1,1,1,1,1,1,1,1,1,0,0
5005 DATA 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
5006 DATA 0,0,1,1,1,1,1,1,1,1,1,1,0,0,0
5007 DATA 0,0,0,1,1,1,1,1,1,1,1,0,0,0,0
5008 DATA 0,1,1,1,1,1,1,1,1,1,1,1,1,0,0
5010 REM TURTLE 2
5011 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5012 DATA 0,0,0,0,1,1,1,1,1,1,0,0,0,0,0
5013 DATA 0,0,0,0,1,1,1,1,1,1,0,0,0,0,0
5014 DATA 0,0,0,0,1,1,1,1,1,1,0,0,0,0,0
5015 DATA 0,0,0,0,1,1,1,1,1,1,0,0,0,0,0
5016 DATA 0,0,0,0,1,1,1,1,1,1,0,0,0,0,0
5017 DATA 0,0,0,0,1,1,1,1,1,1,0,0,0,0,0
5018 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5020 REM TURTLE 3
5021 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5022 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5023 DATA 0,0,0,0,0,1,1,1,1,0,0,0,0,0,0
5024 DATA 0,0,0,0,0,1,1,1,1,0,0,0,0,0,0
5025 DATA 0,0,0,0,0,1,1,1,1,0,0,0,0,0,0
5026 DATA 0,0,0,0,0,1,1,1,1,0,0,0,0,0,0
5027 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5028 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5030 REM TURTLE 4
5031 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5032 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5033 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5034 DATA 0,0,0,0,0,0,1,1,0,0,0,0,0,0,0
5035 DATA 0,0,0,0,0,0,1,1,0,0,0,0,0,0,0
5036 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5037 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
5038 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6000 REM TURTLE 1
6001 DATA 0,1,1,1,1,1,1,1,1,1,1,1,1,0,0
6002 DATA 0,0,0,1,0,0,0,0,0,0,1,0,0,0,0
6003 DATA 0,0,1,1,0,0,0,0,0,0,1,1,0,0,0
6004 DATA 0,1,1,1,0,0,0,0,0,0,1,1,1,0,0
6005 DATA 1,1,1,1,0,0,0,0,0,0,1,1,1,1,1
6006 DATA 0,0,1,1,0,0,0,0,0,0,1,1,0,0,0
6007 DATA 0,0,0,1,0,0,0,0,0,0,1,0,0,0,0
6008 DATA 0,1,1,1,1,1,1,1,1,1,1,1,1,0,0
6010 REM TURTLE 2
6011 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6012 DATA 0,0,0,0,1,1,1,1,1,1,0,0,0,0,0
6013 DATA 0,0,0,0,1,0,0,0,0,1,0,0,0,0,0
6014 DATA 0,0,0,0,1,0,0,0,0,1,0,0,0,0,0
6015 DATA 0,0,0,0,1,0,0,0,0,1,0,0,0,0,0
6016 DATA 0,0,0,0,1,0,0,0,0,1,0,0,0,0,0
6017 DATA 0,0,0,0,1,1,1,1,1,1,0,0,0,0,0
6018 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6020 REM TURTLE 3
6021 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6022 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6023 DATA 0,0,0,0,0,1,1,1,1,0,0,0,0,0,0
6024 DATA 0,0,0,0,0,1,0,0,1,0,0,0,0,0,0
6025 DATA 0,0,0,0,0,1,0,0,1,0,0,0,0,0,0
6026 DATA 0,0,0,0,0,1,1,1,1,0,0,0,0,0,0
6027 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6028 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6030 REM TURTLE 4
6031 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6032 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6033 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6034 DATA 0,0,0,0,0,0,1,1,0,0,0,0,0,0,0
6035 DATA 0,0,0,0,0,0,1,1,0,0,0,0,0,0,0
6036 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6037 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
6038 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
