1 REM TEMPLE OF APSHAI, INNKEEPER - TRS80, LEVEL ii, COPYRIGHT 1979, AUTOMATED SIMULATIONS, REV 1
5 CLEAR800:DEFINTD,I-Y
10 DIMNA$(5),W(5),P(5),NC$(6),CH(6),SD(2),SP(2),SW(2),NW$(6),WW(5),WP(5),WD(5),WR(5),DS(1,1),DW(5,1),R$(6),RR(6),NS$(2)
20 C%=15360:KA=-1*(65536-46864):Q=60:KB=KA+2251
30 J8=248:J0=59:J7=249:JQ=1
50 DATA"NONE",0,0,"LEATHER",150,30,"RING MAIL",350,100,"CHAIN MAIL",500,150,"PARTIAL PLATE",750,250,"FULL PLATE",1000,1000,"INTELLIGENCE","INTUITION","EGO","STRENGTH","CONSTITUTION","DEXTERITY"
60 FORI=0TO5:READNA$(I),W(I),P(I):W(I)=INT(W(I)/16+.5):NEXTI
70 W(0)=0:FORI=1TO6:READNC$(I):NEXTI
80 DATA"DAGGER",1,5,5,3,7,12,"SHORTSWORD",2,14,6,8,9,12,"BROADSWORD",3,18,7,10,9,13,"HAND-AND-A-HALF SWORD",6,35,8,16,9,14,"GREAT SWORD",9,70,10,15,7,15,"MAGIC SWORD"
85 FORI=1TO5:READNW$(I),WW(I),WP(I),WD(I),WR(I):FORJ=0TO1:READDW(I,J):NEXTJ:NEXTI:READNW$(6)
90 DATA6,3,10,8,15,12,5,15,6,17
95 FORI=1TO2:READSW(I),SD(I),SP(I):FORJ=0TO1:READDS(I-1,J):NEXTJ:NEXTI
99 LS=0:SM=0
100 DATA"I'D NOT PART WITH THESE FINE GOODS FOR THAT PITTANCE!    MAYHAP FOR",5,"NOT SO CHEAP MY FRIEND! BUT FOR THEE JUST",10,"BLACKHEART! THOU TAKEST THE FOOD FROM MY CHILDREN'S MOUTHS! I'LL NOT SETTLE FOR LESS THAN",5
110 DATA"WELL, LIFE IS SHORT AND THY ARSE LONG! WHAT SAY THEE TO",2,"HMM...BUT SUCH FINE WORKMANSHIP. i COULD NOT PART WITH THIS FOR LESS THAN",10,"A POX ON THEE! BUT I'D TAKE",3
130 RN=6:RT=0:FORI=1TORN:READR$(I),RR(I):RT=RT+RR(I):NEXTI
140 DATA"NONE","SMALL","LARGE":FORI=0TO2:READNS$(I):NEXTI
800 GOTO1000
900 RANDOM:CLS:PRINTCHR$(23):PRINT@276,"DUNJONQUEST":PRINT@140,"THE TEMPLE OF APSHAI"
910 PRINT@594,"COPYRIGHT 1979":PRINT@714,"AUTOMATED  SIMULATIONS"
915 J=191:FORI=0TO63STEP2:POKEC%+I,J:NEXTI:FORI=960TO1023STEP2:POKEC%+I,J:NEXTI:FORI=64TO896STEP64:POKEC%+I,J:NEXTI:FORI=126TO958STEP64:POKEC%+I,J:NEXTI
917 K=140:FORI=834TO892STEP2:POKEC%+I,K:NEXTI
920 PRINT@904,"HIT ANY KEY TO CONTINUE";
930 I=RND(5):A$=INKEY$:IFLEN(A$)=0GOTO930
940 POKEKB,0
990 RETURN
1000 IFPEEK(KB-12)<>123THENGOSUB900
1001 CLS:WC=5:PRINT"THUS QUOTH THE INNKEEPER:"
1003 IFPEEK(KB-12)=123THENINPUT"WOULDST THOU KNOW WHAT TREASURES THOU HAST";A$:IFLEFT$(A$,1)="Y"THENGOSUB9920
1004 IFPEEK(KB-12)=123THENGOSUB4500
1005 IFPEEK(KB-12)=123THENPRINT"I TRUST THINE WAS A PLEASANT SOJOURN WITHIN THE TEMPLE.":PRINT"ART BUT PASSING THROUGH THE INN AND WISH TO RETURN";:INPUTA$:IFLEFT$(A$,1)="Y"THENGOSUB9900:INPUT"HOW MANY SILVER PIECES HAST THOU";MO:OM=MO:GOSUB2600:GOTO1205
1009 POKEKB-12,0
1010 PRINT"HAIL AND WELL MET! SHALL I FIND THEE A GOODLY CHARACTER, OR HASTTHOU BROUGHT ONE WITH THEE?  pRITHEE, SAY YEA IF i SHOULD.":INPUTC$:IFLEFT$(C$,1)="Y"THENGOSUB2200:ELSEGOSUB2400
1200 OM=MO:INPUT"CHARACTER NAME";NM$:IFMO>0THENGOSUB2600
1205 IFMO>0THENGOSUB2800
1206 IFPS=0THENWP=WP+SP:SP=0
1210 PB=PB-WP-INT(PEEK(KB+15)/2):IFWP>0THENPA=PA+WP-1ELSEIFWP<0THENPA=PA+WP+1
1211 IFMO=0GOTO1215ELSEGOSUB2000
1212 IFMO=0GOTO1215ELSEGOSUB3000
1213 IFMO=0GOTO1215ELSEGOSUB3200
1215 SE=100
1218 INPUT"MONSTER SPEED (SLOW,MEDIUM, OR FAST)";C$:IFLEFT$(C$,1)="S"THENSE=250ELSEIFLEFT$(C$,1)="F"THENSE=60ELSESE=120
1219 POKEKB+9,SE:POKEKB+11,HS:POKEKB+13,RS:POKEKB+14,RM:POKEKB+12,WC:POKEKB+7,WM
1220 POKEKB+24,CA:POKEKB+6,HN:POKEKB+11,HS
1221 POKEKB+23,AS:POKEKB+7,WM:POKEKB+18,PB:POKEKB+19,PA:POKEKB+21,IT:POKEKB+22,EG:POKEKB+4,SP:POKEKB+25,DX:J=INT(EX#/65536):POKEKB+3,J:JJ=INT(EX#/256-J*256):POKEKB+2,JJ:POKEKB+1,EX#-256*JJ-65536*J
1223 WC=5+WW(PEEK(KB+17))+W(AA)+SW(INT(PEEK(KB)/2))+1+(RS+RM)/10
1225 POKEKB+13,RS:POKEKB+14,RM:POKEKB+12,WC:POKEKB+20,CH(1)
1230 POKEKB+10,SM
1260 POKEKB,PS
1270 POKEKB+8,AA:IFPEEK(KB-12)=123GOTO1400
1315 J=LEN(NM$):IFJ>11THENJ=11
1320 FORI=1TOJ:POKEKB-12+I,ASC(MID$(NM$,I,1)):NEXTI
1330 IFJ<11THENFORI=J+1TO11:POKEKB-12+I,ASC(" "):NEXTI
1400 GOSUB4500
1500 POKEKB-12,123
1600 INPUT"ENTER DUNGEON LEVEL";L$:LV=VAL(L$)
1605 IFPEEK(KA)=LVGOTO1670
1607 N=PEEK(KB-11)
1610 AN$="LEVEL"+L$:OPEN"I",1,AN$
1620 INPUT#1,A$:LQ=ASC(LEFT$(A$,1))-J0:PRINT"LEVEL:"LQ
1625 K=0
1630 IFLV=LQTHENGOSUB1950
1640 FORI=2TO9
1642 IFLEN(A$)=249GOTO1650
1644 PRINT"*** POSSIBLE DATA READ ERROR - BLOCK LENGTH ="LEN(A$);" ***"
1650 INPUT#1,A$:IFLV=LQTHENGOSUB1950
1665 NEXTI
1666 CLOSE1
1667 POKEKB-11,N
1670 POKEKB-12,123:PRINT"LEVEL COMPLETE - LOADING DUNJONMASTER":RUN"DM
1900 STOP
1950 IA=VARPTR(A$):IA=-1*(65536-PEEK(IA+1)-256*PEEK(IA+2))
1955 FORJ=0TOJ8:L=PEEK(IA+J)
1965 POKEKA+K+J,L-J0:NEXTJ:K=K+J7:RETURN
2000 INPUT"WILT THOU BUY NEW ARMOR";A$:IFLEFT$(A$,1)="Y"THENFORI=1TO900:NEXTI:CLS:PRINT"TYPE"TAB(25);"WEIGHT"TAB(35);"OFFERED PRICE":ELSERETURN
2010 FORI=1TO5:PRINTNA$(I);TAB(25);W(I);TAB(35);P(I):NEXTI
2020 INPUT"WHAT SORT OF ARMOR WOULDST THOU WEAR";A$:IFLEFT$(A$,1)="N"THENAM=0:AA=0:RETURN
2021 FORI=1TO5:IFLEFT$(A$,2)=LEFT$(NA$(I),2)THENN=I:GOTO2026
2022 NEXTI:PRINT"I HAVE NOT "A$;" FOR SALE":GOTO2020
2024 IFPEEK(KB-12)=123THENWC=WC-W(AA)
2026 LO=.3*P(N):AK=P(N):A1=AK:GOSUB4000:IFOO=0GOTO2020
2030 AA=N:MO=MO-OO:WC=WC+W(N):POKEKB+16,0
2040 PRINT"THOU HAST"MO;"SILVER PIECES LEFT IN THY PURSE":RETURN
2190 J=RND(6)+RND(6)+RND(6):RETURN
2200 HB=0:SC=0:FORI=1TO6:GOSUB2190:CH(I)=J:SC=SC+J:NEXTI:IFSC<60ORCH(4)<8ORCH(5)<7GOTO2200
2205 EX#=0:RS=0:RM=0:AA=0:PS=0:POKEKB+17,0:SP=0:WP=1:AM=0:SM=0:HS=0:HN=0:POKEKB+15,1
2210 CLS:PRINT"THY QUALITIES:":FORI=1TO6:PRINTNC$(I);TAB(25);CH(I):NEXTI
2215 FORI=1TO6:POKEKA-97+I,CH(I):NEXTI
2220 PRINT" ":GOSUB2190:MO=J*10:PRINT"THOU HAST"MO;" PIECES OF SILVER"
2225 GOSUB2250:L=1:POKEKB+16,0
2230 EG=CH(3):IN=CH(1):AS=CH(4):CA=CH(5):IT=CH(2):DX=CH(6):PA=11:PB=11
2240 RETURN
2250 FORI=KA-90TOKA-81:POKEI,0:NEXTI:RETURN
2400 POKEKB+15,0:FORI=1TO6:PRINT"ENTER "NC$(I);:INPUTCH(I):POKEKA-97+I,CH(I):IFCH(I)>18THENPRINTCH(I);"BE TOO HIGH. NO MORE THAN 18 CAN IT BE.":I=I-1
2403 NEXTI
2405 INPUT"THY CHARACTER'S EXPERIENCE IS";EX#:IFEX#>16000000THENPRINT"THEY CHARACTER IS TOO WORLDWISE; FIND ANOTHER MY FRIEND":GOTO2400
2410 E=EX#/1000:FORL=1TO20:IF2[L>ETHENGOTO2420:ELSENEXTL
2420 INPUT"HOW MUCH MONEY HAST THOU TO SPEND";MO
2425 GOSUB2500 'PRESUMES A STRANGER TO THE QUEST SYSTEM
2427 INPUT"WHAT KIND OF SWORD HAST THOU";A$:FORI=1TO5:IFLEFT$(A$,1)=LEFT$(NW$(I),1)THENIFCH(4)>=WR(I)THENN=I:OO=0:GOSUB2690:GOTO2429
2428 NEXTI:PRINT"THOU CANNOT TAKE A "A$;" TO THE DUNJON. THOU MUST BUY ANOTHER"
2429 INPUT"WHAT SORT OF ARMOR DOST THOU WEAR";A$:FORI=0TO5:IFLEFT$(A$,2)=LEFT$(NA$(I),2)THENN=I:OO=0:GOSUB2030:GOTO2435
2432 NEXTI:PRINT"THOU CANNOT WEAR "A$;" IN THE DUNJON":GOTO2429
2435 N=0:INPUT"HAST THOU A SHIELD";A$:IFLEFT$(A$,1)="Y"THENINPUT"BE IT LARGE OR SMALL";A$:N=1:IFLEFT$(A$,1)="L"THENN=2
2437 IFN>0THENGOSUB2865
2439 INPUT"HAST THOU A BOW";A$:IFLEFT$(A$,1)="Y"THENHB=1ELSEHB=0
2440 INPUT"HOW MANY ARROWS HAST THOU";RS:INPUT"HOW MANY MAGIC ARROWS HAST THOU";RM
2450 INPUT"HOW MANY HEALING POTIONS HAST THOU NOW";HN:INPUT"HOW MANY HEALING SALVES HAST THOU";HS:IFHS>10THENHS=10
2480 INPUT"IS THY SWORD MAGICAL";A$:IFLEFT$(A$,1)="Y"THENINPUT"WHAT BE THE PLUS";SM
2485 POKEKB+16,0:INPUT"IS THY ARMOR MAGICAL";A$:IFLEFT$(A$,1)="Y"THENINPUT"WHAT BE THE PLUS";AM:POKEKB+16,AM
2490 GOSUB2250:GOTO2230
2500 IFW2=1THENWP=L:SP=0:ELSEWP=INT((L+1)/2):SP=L-WP
2503 IFPEEK(KB+15)=LTHENRETURNELSEPOKEKB+15,L
2505 IFPEEK(KB-12)=123THENJ=L-1:L=2:ONJGOTO2510,2520,2530,2540,2550,2510,2520,2530,2540,2550
2510 L=L-1:IFL=0GOTO2565
2515 IFCH(5)<9THENCH(5)=CH(5)+1ELSECH(4)=CH(4)+1
2520 L=L-1:IFL=0GOTO2565
2525 IFCH(6)<9THENCH(6)=CH(6)+1ELSECH(5)=CH(5)+1
2530 L=L-1:IFL=0GOTO2565
2535 CH(5)=CH(5)+1
2540 L=L-1:IFL=0GOTO2565
2545 IFCH(6)<9THENCH(6)=CH(6)+1:ELSEIFCH(4)<CH(5)THENCH(4)=CH(4)+1:ELSECH(5)=CH(5)+1
2550 L=L-1:IFL=0GOTO2565
2555 IFCH(2)<CH(3)THENCH(2)=CH(2)+1ELSECH(3)=CH(3)+1
2560 GOTO2510
2565 FORI=1TO6:M=CH(I)-18:IFM<=0GOTO2580
2570 CH(I)=18:FORJ=1TOM:IFCH(4)<18THENCH(4)=CH(4)+1:GOTO2575
2571 IFCH(5)<18THENCH(5)=CH(5)+1:GOTO2575
2573 IFCH(6)<18THENCH(6)=CH(6)+1:GOTO2575
2574 R=RND(3):CH(R)=CH(R)+1
2575 NEXTJ
2580 NEXTI:CA=CH(5):AS=CH(4):DX=CH(6):EG=CH(3):IT=CH(2):RETURN
2600 PRINT"WILT THOU BUY ONE OF OUR FINE SWORDS":INPUTA$:IFLEFT$(A$,1)="N"THENN=PEEK(KB+17):GOSUB2694:RETURN:ELSEW2=0
2650 PRINT"WEAPON"TAB(30);"WEIGHT"TAB(40);"ASKING PRICE"
2660 FORI=1TO5:PRINTNW$(I);TAB(30);WW(I);TAB(40);WP(I):NEXTI
2670 INPUT"WHAT WEAPON WILT THOU PURCHASE";A$:FORI=1TO5:IFLEFT$(A$,1)=LEFT$(NW$(I),1)THENN=I:GOTO2675:ELSEIFLEFT$(A$,1)="N"THENN=PEEK(KB+17):GOSUB2694:RETURN
2672 NEXTI:PRINT"I HAVE NOT SUCH A WEAPON AS A "A$:GOTO2670
2675 IFWR(N)>ASTHENPRINT"THOU CANNOT WIELD SUCH A GREAT WEAPON":GOTO2670
2677 PRINT"FEAST THY EYES 'PON THIS FINE "NW$(N):IFRND(3)>2THENPRINT"'TIS SURE TO ALWAYS DRINK THY FOE'S BLOOD":ELSEPRINT"'TIS WELL FORGED IRON"
2678 LO=.3*WP(N):AK=WP(N):A1=AK:GOSUB4000:IFOO=0GOTO2670
2680 MO=MO-OO:PRINT"THOU HAST"MO;" SILVER PIECES LEFT"
2690 WM=INT(WD(N)*AS/10+.5):SM=0:POKEKB+10,0:POKEKB+17,N:WC=WC+WW(N):IFN=5THENW2=1
2694 IFDW(N,0)>CH(6)THENWP=WP+CH(6)-DW(N,0)ELSEIFDW(N,1)<CH(6)THENWP=WP+CH(6)-DW(N,1)
2696 IFWP>0THENWP=INT(1.3*LOG(WP)+1)
2700 RETURN
2800 IFW2=1THENPS=0:POKEKB,0:SP=0:RETURN
2840 INPUT"WILT THOU BUY A SHIELD";A$:IFLEFT$(A$,1)="N"THENGOSUB2885:RETURN:ELSEPRINT"SHIELD     WEIGHT     ASK":PRINT"SMALL"TAB(11);SW(1);TAB(22);SP(1):PRINT"LARGE"TAB(11);SW(2);TAB(22);SP(2):INPUT"WHAT SORT";C$:IFLEFT$(C$,1)="L"THENN=2ELSEN=1
2842 IFLEFT$(C$,1)="L"THENN=2ELSEIFLEFT$(C$,1)="S"THENN=1ELSEN=0:POKEKB,0:PS=0:RETURN
2850 LO=.3*SP(N):AK=SP(N):A1=AK:GOSUB4000:IFOO=0THENGOTO2840
2865 IFDS(N-1,0)>DXTHENSP=SP+DX-DS(N-1,0)ELSEIFDS(N-1,1)<DXTHENSP=SP+DX-DS(N-1,1)
2870 MO=MO-OO:PRINT"THOU HAST"MO;"SILVER PIECES LEFT":WC=WC+SW(N):PS=SD(N):POKEKB,PS:GOSUB2885:RETURN
2885 IFPS=5THENSP=INT(SP/2)
2890 IFSP>0THENSP=INT(1.3*LOG(SP)+1)
2895 SP=2*PS+SP:RETURN
3000 IFHB>0GOTO3030
3010 INPUT"WILT THOU BUY A BOW";C$:IFLEFT$(C$,1)="N"THENRETURN
3020 PRINT"I'VE A  FINE BOW, YEW AND NEARLY NEW, FOR 12 SILVER PIECES":LO=4:AK=12:A1=AK:GOSUB4000:IFOO=0THENRETURN
3025 MO=MO-OO:PRINT"THOU HAST"MO;"REMAINING"
3030 IFRS+RM>60THENRS=60-RM:GOTO3050
3040 N=0:INPUT"HOW MANY ARROWS WILT THOU BUY (AT 5 COPPERS EACH)";N:IFINT((N+1)/2)>MOTHENPRINT"NO CREDIT":GOTO3040:ELSEIFRS+RM+N>60THENPRINT"THOU CANST CARRY BUT 60 ARROWS. BUY FEWER.":GOTO3040
3045 RS=RS+N:MO=MO-INT((N+1)/2)
3050 RETURN
3200 REM
3210 INPUT"HOW MANY SALVES WILT THOU BUY? THEY COST THEE 10 SILVER PIECES  EACH";N:IF10*N>MOTHENPRINT"NO CREDIT":GOTO3210:ELSEMO=MO-10*N:HS=HS+N:IFHS>10THENN=HS-10:MO=MO+10*N:HS=10:PRINT"MORE THAN 10 WILL DO THEE NO GOOD"
3220 IFMO<.35*OMTHENPRINTNM$;"! THOU SPENDTHRIFT!":PRINT"THOU HAST BUT"MO;"SILVER PIECES LEFT TO THEE"ELSEPRINTNM$;", THOU ART FRUGAL. THOU HAST"MO;"SILVER PIECES LEFT."
3230 RETURN
4000 IFRND(3)>2THENPRINT"WHAT BE THY OFFER "NM$;"?":ELSEPRINT"WHAT OFFEREST THOU?"
4010 INPUTOO:IFOO>MOTHENPRINT"LIAR, THOU HAST BUT"MO:GOTO4000
4020 IFOO=0THENLS=0:RETURN
4030 IFOO<=LOTHENGOSUB4800:GOTO4000
4035 IFOO<=LSTHENGOSUB4700:GOTO4000
4040 IFOO>=AKTHENPRINT"DONE":LS=0:RETURN
4050 IFOO>AK-.3*RND(0)[2*AKTHENIFOO<.6*A1THENPRINT"THOU ART A HARD BARGAINER "NM$:LS=0:RETURN:ELSEPRINT"DONE":LS=0:RETURN
4055 IFRND(200)=200THENPRINT"i SEE THE GODS LOOK WITH FAVOR ON THEE, SO TAKE IT FOR THAT":LS=0:RETURN
4058 B=20/(CH(1)+CH(3)):IFCH(3)>12ANDCH(1)<10THENB=20/(CH(1)+20-CH(3))
4060 AK=OO+(AK-OO)*SQR(1-RND(0))*B
4070 LS=OO
4080 GOSUB4900:GOTO4000
4500 CH(1)=PEEK(KB+20):CH(2)=PEEK(KB+21):CH(3)=PEEK(KB+22):CH(4)=PEEK(KB+23):CH(5)=PEEK(KB+24):CH(6)=PEEK(KB+25):SM=PEEK(KB+10):RM=PEEK(KB+14):RS=PEEK(KB+13):AA=PEEK(KB+8):WM=PEEK(KB+7)-SM:WN=PEEK(KB+17)
4505 IFSM<>0THENWN=6
4510 GOSUB9800:CLS:PRINT"CHARACTER SUMMARY FOR "NM$
4520 PRINT"":FORI=1TO6:PRINTNC$(I);TAB(20);PEEK(KA-97+I):NEXTI
4525 J=0:IFPEEK(KB)=3THENJ=1ELSEIFPEEK(KB)=5THENJ=2
4530 PRINT"WEAPON: "NW$(WN);TAB(32);"ARMOR: "NA$(AA)
4532 IFWN=6THENPRINT"PLUS:"PEEK(KB+10);
4533 IFPEEK(KB+16)>0THENPRINTTAB(32);"PLUS:"PEEK(KB+16):ELSEPRINT" "
4535 PRINT"ARROWS:"RS;TAB(22);"MAGIC ARROWS:"RM;TAB(45);"SHIELD: "NS$(J)
4537 PRINT"SALVES:"PEEK(KB+11);TAB(22);"ELIXIRS:"PEEK(KB+6);TAB(45);"SILVER:"MO
4540 PRINT"EXPERIENCE:"PEEK(KB+1)+256*PEEK(KB+2)+65536*PEEK(KB+3);TAB(22);"WEIGHT CARRIED:"PEEK(KB+12)
4550 RETURN
4700 R=RND(3):R=RND(3):ONRND(3)GOTO4710,4720,4730
4710 PRINT"DOST THOU TAKE ME FOR A DOLT?":RETURN
4720 PRINT"FOOL OR KNAVE "NM$;"! MAKE AN OFFER HIGHER THAN THY LAST":RETURN
4730 PRINT"PERCHANCE THOU WOULDST NOT HAVE THIS AT ALL?":RETURN
4800 IFRND(100)>50THENPRINT"HA! 'TIS LESS THAN I PAID FOR IT"ELSEPRINT"I SPIT ON THY PALTRY OFFER"
4810 RETURN
4900 FORI1=1TO10:R=RND(RT):NEXTI1:RQ=0:R=RND(RT)-1:FORI1=1TORN:RQ=RQ+RR(I1):IFRQ<RTHENNEXTI1:ELSEPRINTR$(I1);INT(AK+.999):RETURN
9800 NM$="":FORI=1TO11:NM$=NM$+CHR$(PEEK(KB-12+I)):NEXTI
9810 FORI=1TO10:IFMID$(NM$,12-I,1)<>" "GOTO9830
9820 NEXTI
9830 NM$=LEFT$(NM$,12-I):RETURN
9900 SM=PEEK(KB+10):HS=PEEK(KB+11):HN=PEEK(KB+6):RS=PEEK(KB+13):RM=PEEK(KB+14):FORI=1TO6:CH(I)=PEEK(KB+19+I):NEXTI:AA=PEEK(KB+8):WM=PEEK(KB+7):PS=PEEK(KB):WC=PEEK(KB+12):IFAA=5THENW2=1ELSEW2=0
9907 EX#=PEEK(KB+1)+256*PEEK(KB+2)+65536*PEEK(KB+3):IFEX#>1999THENL=LOG(EX#/1000)/LOG(2)+1ELSEL=1
9908 HB=1:GOSUB2500:GOSUB2230
9910 RETURN
9920 GOSUB9800:CLS:PRINT"TREASURES FOR "NM$:PRINT"TREASURE"TAB(12);"#"TAB(24);"TREASURE"TAB(36);"#"
9930 FORI=1TO20STEP2:PRINTI;TAB(12);PEEK(KA-81+I);TAB(24);I+1;TAB(36);PEEK(KA-80+I):NEXTI:INPUT"ART THOU READY FOR MORE";A$:RETURN

1 REM TEMPLE OF APSHAI, INNKEEPER - TRS80, LEVEL ii, COPYRIGHT 1979, AUTOMATED SIMULATIONS, REV 1
5 CLEAR800:DEFINTD,I-Y
10 DIMNA$(5),W(5),P(5),NC$(6),CH(6),SD(2),SP(2),SW(2),NW$(6),WW(5),WP(5),WD(5),WR(5),DS(1,1),DW(5,1),R$(6),RR(6),NS$(2)
20 C%=15360:KA=-1*(65536-46864):Q=60:KB=KA+2251
30 J8=248:J0=59:J7=249:JQ=1
50 DATA"NONE",0,0,"LEATHER",150,30,"RING MAIL",350,100,"CHAIN MAIL",500,150,"PARTIAL PLATE",750,250,"FULL PLATE",1000,1000,"INTELLIGENCE","INTUITION","EGO","STRENGTH","CONSTITUTION","DEXTERITY"
60 FORI=0TO5:READNA$(I),W(I),P(I):W(I)=INT(W(I)/16+.5):NEXTI
70 W(0)=0:FORI=1TO6:READNC$(I):NEXTI
80 DATA"DAGGER",1,5,5,3,7,12,"SHORTSWORD",2,14,6,8,9,12,"BROADSWORD",3,18,7,10,9,13,"HAND-AND-A-HALF SWORD",6,35,8,16,9,14,"GREAT SWORD",9,70,10,15,7,15,"MAGIC SWORD"
85 FORI=1TO5:READNW$(I),WW(I),WP(I),WD(I),WR(I):FORJ=0TO1:READDW(I,J):NEXTJ:NEXTI:READNW$(6)
90 DATA6,3,10,8,15,12,5,15,6,17
95 FORI=1TO2:READSW(I),SD(I),SP(I):FORJ=0TO1:READDS(I-1,J):NEXTJ:NEXTI
99 LS=0:SM=0
100 DATA"I'D NOT PART WITH THESE FINE GOODS FOR THAT PITTANCE!    MAYHAP FOR",5,"NOT SO CHEAP MY FRIEND! BUT FOR THEE JUST",10,"BLACKHEART! THOU TAKEST THE FOOD FROM MY CHILDREN'S MOUTHS! I'LL NOT SETTLE FOR LESS THAN",5
110 DATA"WELL, LIFE IS SHORT AND THY ARSE LONG! WHAT SAY THEE TO",2,"HMM...BUT SUCH FINE WORKMANSHIP. i COULD NOT PART WITH THIS FOR LESS THAN",10,"A POX ON THEE! BUT I'D TAKE",3
130 RN=6:RT=0:FORI=1TORN:READR$(I),RR(I):RT=RT+RR(I):NEXTI
140 DATA"NONE","SMALL","LARGE":FORI=0TO2:READNS$(I):NEXTI
800 GOTO1000
900 RANDOM:CLS:PRINTCHR$(23):PRINT@276,"DUNJONQUEST":PRINT@140,"THE TEMPLE OF APSHAI"
910 PRINT@594,"COPYRIGHT 1979":PRINT@714,"AUTOMATED  SIMULATIONS"
915 J=191:FORI=0TO63STEP2:POKEC%+I,J:NEXTI:FORI=960TO1023STEP2:POKEC%+I,J:NEXTI:FORI=64TO896STEP64:POKEC%+I,J:NEXTI:FORI=126TO958STEP64:POKEC%+I,J:NEXTI
917 K=140:FORI=834TO892STEP2:POKEC%+I,K:NEXTI
920 PRINT@904,"HIT ANY KEY TO CONTINUE";
930 I=RND(5):A$=INKEY$:IFLEN(A$)=0GOTO930
940 POKEKB,0
990 RETURN
1000 IFPEEK(KB-12)<>123THENGOSUB900
1001 CLS:WC=5:PRINT"THUS QUOTH THE INNKEEPER:"
1003 IFPEEK(KB-12)=123THENINPUT"WOULDST THOU KNOW WHAT TREASURES THOU HAST";A$:IFLEFT$(A$,1)="Y"THENGOSUB9920
1004 IFPEEK(KB-12)=123THENGOSUB4500
1005 IFPEEK(KB-12)=123THENPRINT"I TRUST THINE WAS A PLEASANT SOJOURN WITHIN THE TEMPLE.":PRINT"ART BUT PASSING THROUGH THE INN AND WISH TO RETURN";:INPUTA$:IFLEFT$(A$,1)="Y"THENGOSUB9900:INPUT"HOW MANY SILVER PIECES HAST THOU";MO:OM=MO:GOSUB2600:GOTO1205
1009 POKEKB-12,0
1010 PRINT"HAIL AND WELL MET! SHALL I FIND THEE A GOODLY CHARACTER, OR HASTTHOU BROUGHT ONE WITH THEE?  pRITHEE, SAY YEA IF i SHOULD.":INPUTC$:IFLEFT$(C$,1)="Y"THENGOSUB2200:ELSEGOSUB2400
1200 OM=MO:INPUT"CHARACTER NAME";NM$:IFMO>0THENGOSUB2600
1205 IFMO>0THENGOSUB2800
1206 IFPS=0THENWP=WP+SP:SP=0
1210 PB=PB-WP-INT(PEEK(KB+15)/2):IFWP>0THENPA=PA+WP-1ELSEIFWP<0THENPA=PA+WP+1
1211 IFMO=0GOTO1215ELSEGOSUB2000
1212 IFMO=0GOTO1215ELSEGOSUB3000
1213 IFMO=0GOTO1215ELSEGOSUB3200
1215 SE=100
1218 INPUT"MONSTER SPEED (SLOW,MEDIUM, OR FAST)";C$:IFLEFT$(C$,1)="S"THENSE=250ELSEIFLEFT$(C$,1)="F"THENSE=60ELSESE=120
1219 POKEKB+9,SE:POKEKB+11,HS:POKEKB+13,RS:POKEKB+14,RM:POKEKB+12,WC:POKEKB+7,WM
1220 POKEKB+24,CA:POKEKB+6,HN:POKEKB+11,HS
1221 POKEKB+23,AS:POKEKB+7,WM:POKEKB+18,PB:POKEKB+19,PA:POKEKB+21,IT:POKEKB+22,EG:POKEKB+4,SP:POKEKB+25,DX:J=INT(EX#/65536):POKEKB+3,J:JJ=INT(EX#/256-J*256):POKEKB+2,JJ:POKEKB+1,EX#-256*JJ-65536*J
1223 WC=5+WW(PEEK(KB+17))+W(AA)+SW(INT(PEEK(KB)/2))+1+(RS+RM)/10
1225 POKEKB+13,RS:POKEKB+14,RM:POKEKB+12,WC:POKEKB+20,CH(1)
1230 POKEKB+10,SM
1260 POKEKB,PS
1270 POKEKB+8,AA:IFPEEK(KB-12)=123GOTO1400
1315 J=LEN(NM$):IFJ>11THENJ=11
1320 FORI=1TOJ:POKEKB-12+I,ASC(MID$(NM$,I,1)):NEXTI
1330 IFJ<11THENFORI=J+1TO11:POKEKB-12+I,ASC(" "):NEXTI
1400 GOSUB4500
1500 POKEKB-12,123
1600 INPUT"ENTER DUNGEON LEVEL";L$:LV=VAL(L$)
1605 IFPEEK(KA)=LVGOTO1670
1607 N=PEEK(KB-11)
1610 AN$="LEVEL"+L$:OPEN"I",1,AN$
1620 INPUT#1,A$:LQ=ASC(LEFT$(A$,1))-J0:PRINT"LEVEL:"LQ
1625 K=0
1630 IFLV=LQTHENGOSUB1950
1640 FORI=2TO9
1642 IFLEN(A$)=249GOTO1650
1644 PRINT"*** POSSIBLE DATA READ ERROR - BLOCK LENGTH ="LEN(A$);" ***"
1650 INPUT#1,A$:IFLV=LQTHENGOSUB1950
1665 NEXTI
1666 CLOSE1
1667 POKEKB-11,N
1670 POKEKB-12,123:PRINT"LEVEL COMPLETE - LOADING DUNJONMASTER":RUN"DM
1900 STOP
1950 IA=VARPTR(A$):IA=-1*(65536-PEEK(IA+1)-256*PEEK(IA+2))
1955 FORJ=0TOJ8:L=PEEK(IA+J)
1965 POKEKA+K+J,L-J0:NEXTJ:K=K+J7:RETURN
2000 INPUT"WILT THOU BUY NEW ARMOR";A$:IFLEFT$(A$,1)="Y"THENFORI=1TO900:NEXTI:CLS:PRINT"TYPE"TAB(25);"WEIGHT"TAB(35);"OFFERED PRICE":ELSERETURN
2010 FORI=1TO5:PRINTNA$(I);TAB(25);W(I);TAB(35);P(I):NEXTI
2020 INPUT"WHAT SORT OF ARMOR WOULDST THOU WEAR";A$:IFLEFT$(A$,1)="N"THENAM=0:AA=0:RETURN
2021 FORI=1TO5:IFLEFT$(A$,2)=LEFT$(NA$(I),2)THENN=I:GOTO2026
2022 NEXTI:PRINT"I HAVE NOT "A$;" FOR SALE":GOTO2020
2024 IFPEEK(KB-12)=123THENWC=WC-W(AA)
2026 LO=.3*P(N):AK=P(N):A1=AK:GOSUB4000:IFOO=0GOTO2020
2030 AA=N:MO=MO-OO:WC=WC+W(N):POKEKB+16,0
2040 PRINT"THOU HAST"MO;"SILVER PIECES LEFT IN THY PURSE":RETURN
2190 J=RND(6)+RND(6)+RND(6):RETURN
2200 HB=0:SC=0:FORI=1TO6:GOSUB2190:CH(I)=J:SC=SC+J:NEXTI:IFSC<60ORCH(4)<8ORCH(5)<7GOTO2200
2205 EX#=0:RS=0:RM=0:AA=0:PS=0:POKEKB+17,0:SP=0:WP=1:AM=0:SM=0:HS=0:HN=0:POKEKB+15,1
2210 CLS:PRINT"THY QUALITIES:":FORI=1TO6:PRINTNC$(I);TAB(25);CH(I):NEXTI
2215 FORI=1TO6:POKEKA-97+I,CH(I):NEXTI
2220 PRINT" ":GOSUB2190:MO=J*10:PRINT"THOU HAST"MO;" PIECES OF SILVER"
2225 GOSUB2250:L=1:POKEKB+16,0
2230 EG=CH(3):IN=CH(1):AS=CH(4):CA=CH(5):IT=CH(2):DX=CH(6):PA=11:PB=11
2240 RETURN
2250 FORI=KA-90TOKA-81:POKEI,0:NEXTI:RETURN
2400 POKEKB+15,0:FORI=1TO6:PRINT"ENTER "NC$(I);:INPUTCH(I):POKEKA-97+I,CH(I):IFCH(I)>18THENPRINTCH(I);"BE TOO HIGH. NO MORE THAN 18 CAN IT BE.":I=I-1
2403 NEXTI
2405 INPUT"THY CHARACTER'S EXPERIENCE IS";EX#:IFEX#>16000000THENPRINT"THEY CHARACTER IS TOO WORLDWISE; FIND ANOTHER MY FRIEND":GOTO2400
2410 E=EX#/1000:FORL=1TO20:IF2[L>ETHENGOTO2420:ELSENEXTL
2420 INPUT"HOW MUCH MONEY HAST THOU TO SPEND";MO
2425 GOSUB2500 'PRESUMES A STRANGER TO THE QUEST SYSTEM
2427 INPUT"WHAT KIND OF SWORD HAST THOU";A$:FORI=1TO5:IFLEFT$(A$,1)=LEFT$(NW$(I),1)THENIFCH(4)>=WR(I)THENN=I:OO=0:GOSUB2690:GOTO2429
2428 NEXTI:PRINT"THOU CANNOT TAKE A "A$;" TO THE DUNJON. THOU MUST BUY ANOTHER"
2429 INPUT"WHAT SORT OF ARMOR DOST THOU WEAR";A$:FORI=0TO5:IFLEFT$(A$,2)=LEFT$(NA$(I),2)THENN=I:OO=0:GOSUB2030:GOTO2435
2432 NEXTI:PRINT"THOU CANNOT WEAR "A$;" IN THE DUNJON":GOTO2429
2435 N=0:INPUT"HAST THOU A SHIELD";A$:IFLEFT$(A$,1)="Y"THENINPUT"BE IT LARGE OR SMALL";A$:N=1:IFLEFT$(A$,1)="L"THENN=2
2437 IFN>0THENGOSUB2865
2439 INPUT"HAST THOU A BOW";A$:IFLEFT$(A$,1)="Y"THENHB=1ELSEHB=0
2440 INPUT"HOW MANY ARROWS HAST THOU";RS:INPUT"HOW MANY MAGIC ARROWS HAST THOU";RM
2450 INPUT"HOW MANY HEALING POTIONS HAST THOU NOW";HN:INPUT"HOW MANY HEALING SALVES HAST THOU";HS:IFHS>10THENHS=10
2480 INPUT"IS THY SWORD MAGICAL";A$:IFLEFT$(A$,1)="Y"THENINPUT"WHAT BE THE PLUS";SM
2485 POKEKB+16,0:INPUT"IS THY ARMOR MAGICAL";A$:IFLEFT$(A$,1)="Y"THENINPUT"WHAT BE THE PLUS";AM:POKEKB+16,AM
2490 GOSUB2250:GOTO2230
2500 IFW2=1THENWP=L:SP=0:ELSEWP=INT((L+1)/2):SP=L-WP
2503 IFPEEK(KB+15)=LTHENRETURNELSEPOKEKB+15,L
2505 IFPEEK(KB-12)=123THENJ=L-1:L=2:ONJGOTO2510,2520,2530,2540,2550,2510,2520,2530,2540,2550
2510 L=L-1:IFL=0GOTO2565
2515 IFCH(5)<9THENCH(5)=CH(5)+1ELSECH(4)=CH(4)+1
2520 L=L-1:IFL=0GOTO2565
2525 IFCH(6)<9THENCH(6)=CH(6)+1ELSECH(5)=CH(5)+1
2530 L=L-1:IFL=0GOTO2565
2535 CH(5)=CH(5)+1
2540 L=L-1:IFL=0GOTO2565
2545 IFCH(6)<9THENCH(6)=CH(6)+1:ELSEIFCH(4)<CH(5)THENCH(4)=CH(4)+1:ELSECH(5)=CH(5)+1
2550 L=L-1:IFL=0GOTO2565
2555 IFCH(2)<CH(3)THENCH(2)=CH(2)+1ELSECH(3)=CH(3)+1
2560 GOTO2510
2565 FORI=1TO6:M=CH(I)-18:IFM<=0GOTO2580
2570 CH(I)=18:FORJ=1TOM:IFCH(4)<18THENCH(4)=CH(4)+1:GOTO2575
2571 IFCH(5)<18THENCH(5)=CH(5)+1:GOTO2575
2573 IFCH(6)<18THENCH(6)=CH(6)+1:GOTO2575
2574 R=RND(3):CH(R)=CH(R)+1
2575 NEXTJ
2580 NEXTI:CA=CH(5):AS=CH(4):DX=CH(6):EG=CH(3):IT=CH(2):RETURN
2600 PRINT"WILT THOU BUY ONE OF OUR FINE SWORDS":INPUTA$:IFLEFT$(A$,1)="N"THENN=PEEK(KB+17):GOSUB2694:RETURN:ELSEW2=0
2650 PRINT"WEAPON"TAB(30);"WEIGHT"TAB(40);"ASKING PRICE"
2660 FORI=1TO5:PRINTNW$(I);TAB(30);WW(I);TAB(40);WP(I):NEXTI
2670 INPUT"WHAT WEAPON WILT THOU PURCHASE";A$:FORI=1TO5:IFLEFT$(A$,1)=LEFT$(NW$(I),1)THENN=I:GOTO2675:ELSEIFLEFT$(A$,1)="N"THENN=PEEK(KB+17):GOSUB2694:RETURN
2672 NEXTI:PRINT"I HAVE NOT SUCH A WEAPON AS A "A$:GOTO2670
2675 IFWR(N)>ASTHENPRINT"THOU CANNOT WIELD SUCH A GREAT WEAPON":GOTO2670
2677 PRINT"FEAST THY EYES 'PON THIS FINE "NW$(N):IFRND(3)>2THENPRINT"'TIS SURE TO ALWAYS DRINK THY FOE'S BLOOD":ELSEPRINT"'TIS WELL FORGED IRON"
2678 LO=.3*WP(N):AK=WP(N):A1=AK:GOSUB4000:IFOO=0GOTO2670
2680 MO=MO-OO:PRINT"THOU HAST"MO;" SILVER PIECES LEFT"
2690 WM=INT(WD(N)*AS/10+.5):SM=0:POKEKB+10,0:POKEKB+17,N:WC=WC+WW(N):IFN=5THENW2=1
2694 IFDW(N,0)>CH(6)THENWP=WP+CH(6)-DW(N,0)ELSEIFDW(N,1)<CH(6)THENWP=WP+CH(6)-DW(N,1)
2696 IFWP>0THENWP=INT(1.3*LOG(WP)+1)
2700 RETURN
2800 IFW2=1THENPS=0:POKEKB,0:SP=0:RETURN
2840 INPUT"WILT THOU BUY A SHIELD";A$:IFLEFT$(A$,1)="N"THENGOSUB2885:RETURN:ELSEPRINT"SHIELD     WEIGHT     ASK":PRINT"SMALL"TAB(11);SW(1);TAB(22);SP(1):PRINT"LARGE"TAB(11);SW(2);TAB(22);SP(2):INPUT"WHAT SORT";C$:IFLEFT$(C$,1)="L"THENN=2ELSEN=1
2842 IFLEFT$(C$,1)="L"THENN=2ELSEIFLEFT$(C$,1)="S"THENN=1ELSEN=0:POKEKB,0:PS=0:RETURN
2850 LO=.3*SP(N):AK=SP(N):A1=AK:GOSUB4000:IFOO=0THENGOTO2840
2865 IFDS(N-1,0)>DXTHENSP=SP+DX-DS(N-1,0)ELSEIFDS(N-1,1)<DXTHENSP=SP+DX-DS(N-1,1)
2870 MO=MO-OO:PRINT"THOU HAST"MO;"SILVER PIECES LEFT":WC=WC+SW(N):PS=SD(N):POKEKB,PS:GOSUB2885:RETURN
2885 IFPS=5THENSP=INT(SP/2)
2890 IFSP>0THENSP=INT(1.3*LOG(SP)+1)
2895 SP=2*PS+SP:RETURN
3000 IFHB>0GOTO3030
3010 INPUT"WILT THOU BUY A BOW";C$:IFLEFT$(C$,1)="N"THENRETURN
3020 PRINT"I'VE A  FINE BOW, YEW AND NEARLY NEW, FOR 12 SILVER PIECES":LO=4:AK=12:A1=AK:GOSUB4000:IFOO=0THENRETURN
3025 MO=MO-OO:PRINT"THOU HAST"MO;"REMAINING"
3030 IFRS+RM>60THENRS=60-RM:GOTO3050
3040 N=0:INPUT"HOW MANY ARROWS WILT THOU BUY (AT 5 COPPERS EACH)";N:IFINT((N+1)/2)>MOTHENPRINT"NO CREDIT":GOTO3040:ELSEIFRS+RM+N>60THENPRINT"THOU CANST CARRY BUT 60 ARROWS. BUY FEWER.":GOTO3040
3045 RS=RS+N:MO=MO-INT((N+1)/2)
3050 RETURN
3200 REM
3210 INPUT"HOW MANY SALVES WILT THOU BUY? THEY COST THEE 10 SILVER PIECES  EACH";N:IF10*N>MOTHENPRINT"NO CREDIT":GOTO3210:ELSEMO=MO-10*N:HS=HS+N:IFHS>10THENN=HS-10:MO=MO+10*N:HS=10:PRINT"MORE THAN 10 WILL DO THEE NO GOOD"
3220 IFMO<.35*OMTHENPRINTNM$;"! THOU SPENDTHRIFT!":PRINT"THOU HAST BUT"MO;"SILVER PIECES LEFT TO THEE"ELSEPRINTNM$;", THOU ART FRUGAL. THOU HAST"MO;"SILVER PIECES LEFT."
3230 RETURN
4000 IFRND(3)>2THENPRINT"WHAT BE THY OFFER "NM$;"?":ELSEPRINT"WHAT OFFEREST THOU?"
4010 INPUTOO:IFOO>MOTHENPRINT"LIAR, THOU HAST BUT"MO:GOTO4000
4020 IFOO=0THENLS=0:RETURN
4030 IFOO<=LOTHENGOSUB4800:GOTO4000
4035 IFOO<=LSTHENGOSUB4700:GOTO4000
4040 IFOO>=AKTHENPRINT"DONE":LS=0:RETURN
4050 IFOO>AK-.3*RND(0)[2*AKTHENIFOO<.6*A1THENPRINT"THOU ART A HARD BARGAINER "NM$:LS=0:RETURN:ELSEPRINT"DONE":LS=0:RETURN
4055 IFRND(200)=200THENPRINT"i SEE THE GODS LOOK WITH FAVOR ON THEE, SO TAKE IT FOR THAT":LS=0:RETURN
4058 B=20/(CH(1)+CH(3)):IFCH(3)>12ANDCH(1)<10THENB=20/(CH(1)+20-CH(3))
4060 AK=OO+(AK-OO)*SQR(1-RND(0))*B
4070 LS=OO
4080 GOSUB4900:GOTO4000
4500 CH(1)=PEEK(KB+20):CH(2)=PEEK(KB+21):CH(3)=PEEK(KB+22):CH(4)=PEEK(KB+23):CH(5)=PEEK(KB+24):CH(6)=PEEK(KB+25):SM=PEEK(KB+10):RM=PEEK(KB+14):RS=PEEK(KB+13):AA=PEEK(KB+8):WM=PEEK(KB+7)-SM:WN=PEEK(KB+17)
4505 IFSM<>0THENWN=6
4510 GOSUB9800:CLS:PRINT"CHARACTER SUMMARY FOR "NM$
4520 PRINT"":FORI=1TO6:PRINTNC$(I);TAB(20);PEEK(KA-97+I):NEXTI
4525 J=0:IFPEEK(KB)=3THENJ=1ELSEIFPEEK(KB)=5THENJ=2
4530 PRINT"WEAPON: "NW$(WN);TAB(32);"ARMOR: "NA$(AA)
4532 IFWN=6THENPRINT"PLUS:"PEEK(KB+10);
4533 IFPEEK(KB+16)>0THENPRINTTAB(32);"PLUS:"PEEK(KB+16):ELSEPRINT" "
4535 PRINT"ARROWS:"RS;TAB(22);"MAGIC ARROWS:"RM;TAB(45);"SHIELD: "NS$(J)
4537 PRINT"SALVES:"PEEK(KB+11);TAB(22);"ELIXIRS:"PEEK(KB+6);TAB(45);"SILVER:"MO
4540 PRINT"EXPERIENCE:"PEEK(KB+1)+256*PEEK(KB+2)+65536*PEEK(KB+3);TAB(22);"WEIGHT CARRIED:"PEEK(KB+12)
4550 RETURN
4700 R=RND(3):R=RND(3):ONRND(3)GOTO4710,4720,4730
4710 PRINT"DOST THOU TAKE ME FOR A DOLT?":RETURN
4720 PRINT"FOOL OR KNAVE "NM$;"! MAKE AN OFFER HIGHER THAN THY LAST":RETURN
4730 PRINT"PERCHANCE THOU WOULDST NOT HAVE THIS AT ALL?":RETURN
4800 IFRND(100)>50THENPRINT"HA! 'TIS LESS THAN I PAID FOR IT"ELSEPRINT"I SPIT ON THY PALTRY OFFER"
4810 RETURN
4900 FORI1=1TO10:R=RND(RT):NEXTI1:RQ=0:R=RND(RT)-1:FORI1=1TORN:RQ=RQ+RR(I1):IFRQ<RTHENNEXTI1:ELSEPRINTR$(I1);INT(AK+.999):RETURN
9800 NM$="":FORI=1TO11:NM$=NM$+CHR$(PEEK(KB-12+I)):NEXTI
9810 FORI=1TO10:IFMID$(NM$,12-I,1)<>" "GOTO9830
9820 NEXTI
9830 NM$=LEFT$(NM$,12-I):RETURN
9900 SM=PEEK(KB+10):HS=PEEK(KB+11):HN=PEEK(KB+6):RS=PEEK(KB+13):RM=PEEK(KB+14):FORI=1TO6:CH(I)=PEEK(KB+19+I):NEXTI:AA=PEEK(KB+8):WM=PEEK(KB+7):PS=PEEK(KB):WC=PEEK(KB+12):IFAA=5THENW2=1ELSEW2=0
9907 EX#=PEEK(KB+1)+256*PEEK(KB+2)+65536*PEEK(KB+3):IFEX#>1999THENL=LOG(EX#/1000)/LOG(2)+1ELSEL=1
9908 HB=1:GOSUB2500:GOSUB2230
9910 RETURN
9920 GOSUB9800:CLS:PRINT"TREASURES FOR "NM$:PRINT"TREASURE"TAB(12);"#"TAB(24);"TREASURE"TAB(36);"#"
9930 FORI=1TO20STEP2:PRINTI;TAB(12);PEEK(KA-81+I);TAB(24);I+1;TAB(36);PEEK(KA-80+I):NEXTI:INPUT"ART THOU READY FOR MORE";A$:RETURN

