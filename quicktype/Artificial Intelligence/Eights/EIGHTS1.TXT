15 CLEAR 300: REM DEFSTR A-L: DEFINT M-Z
18 REM
20 DIM M(51),MT(51),MM(100),P(12,3),T(12,3),Q(3),QS(3),QT(3),QD(3):REM RANDOMIZE
21 V5=1:S8=210:S7=274:RN=100:RM=51
30 C5$="S":C6$="H":C7$="D":C8$="C":C9$="JIM"

54 REM
60 CLS:PRINT@256/2,"A MOMENT WHILE I SHUFFLE..."
80 REM
100 X=0:Y2=6701:GOSUB 150:Y2=6801:GOSUB 150:Y2=7201:GOSUB150:Y2=83010:GOSUB 150:FOR X=0 TO 51:Y5=MT(X)
105 REM
110 Y6=RND(100):IF MM(Y6)>0 THEN 110
111 MM(Y6)=Y5
115 REM
120 NEXT:Y6=0:FOR X=1 TO 100:IF MM(X)=0 THEN NEXT:GOTO130
131 M(Y6)=MM(X):Y6=Y6+1:NEXT
125 REM
130 GOTO6000:GOTO 200:REM CONTROL PASSES TO RULES-DISPLAY ROUTINE
140 REM
150 FOR Y=Y2 TO Y2+12:MT(X)=Y:X=X+1:NEXT:RETURN

200 REM RULES
210 STOP



6000 PD=WD-1:IF WD=8 THEN 6400
6001 FOR X=0 TO 3:QD(X)=0:NEXT:X=0:FOR TC=0 TO 3:Y=T(PD,TC):IF Y>0 THEN QD(TC)=1:X=X+1:NEXT:GOTO6010
6002 NEXT
6003 REM NOTE ANY MATCHING DENOMINATIONS IN OTHER SUITS (UNLESS FOLLOWING 8, 
6004 REM THEN ONLY WANT TO LOOK AT THE FORCED SUIT)
6010 IF X=0 THEN 6400:REM WE JUMP TO 6400 IF THE MACHINE CANNOT MATCH THE DENOMINATION OF THE CARD LED
6015 REM
6020 GOSUB 7010:REM ON RETURN FROM THIS SUBROUTINE WE HAVE STORED THE LENDTH OF EACH SUIT HELD BY THE MACHINE IN THE ARRAY OS
6025 REM
6030 FOR X=0 TO 3:IF QD(X)=0 AND X<>WC THEN QS(X)=0
6031 NEXT:REM THIS TELLS THE MACHINE TO IGNORE SUITS WITHOUT MATCHING DENOMINATIONS BY NULLING THE VALUE IN OS
6035 REM
6040 GOSUB 8600:REM ON RETURN, X3 HAS A VALUE EQUAL TO THE COLUMN IN THE T ARRAY FROM WHICH THE MACHINE WILL PLAY ITS CARD
6045 REM
6050 IF X3=WC THEN 6100:REM TESTING TO SEE IF THE MACHINE'S PREFERRED SUIT IS THE SAME AS THE PLAYER'S LED SUIT
6055 REM
6060 TC=X3:TR=PD:GOTO 8000:REM MACHINE'S CHOSEN SUIT IS IN X3 AND THE DENOMINATION IS THE SAME AS THAT OF THE PLAYER'S CARD
6065 REM
6100 GOSUB 7030:TC=X3:TR=X:GOTO 8000:REM ON RETURN FROM 7030 WE HAVE FOUND THE HIGHEST LARD (OTHER THAN AN 8) IN THE CORRECT SUIT. X3=THE SUIT AND X=THE DENOMINATION
6395 REM
6400 X3=WC:REM WE DON'T HAVE THE SAME DENOMINATION IN ANOTHER SUIT, OR WE ARE FOLLOWING AN 8 WHICH FORCES A PARTICULAR SUIT. LOOK FOR A CARD IN THAT SUIT
6405 REM
6410 GOSUB 7030:REM ON RETURN, X= THE HIGHEST CARD WHICH IS NOT AN 8
6415 REM
6420 IF X=-1 THEN 6440:REM WE HAVE NO CARDS IN THE LED OR FORCED SUIT EXCEPT PERHAPS AN 8
6425 REM
6430 TR=X:TC=WC:GOTO 8000:REM PLAY THE CHOSEN CARD WHICH IS IN THE LED SUIT
6435 REM
6440 FOR X8=0 TO 3:IF T(7,X8)>0 THEN 6460
6441 NEXT:REM IF THE VALUE IS GREATER THAN ZERO WE HAVE AN 8 AND JUMP TO 6460
6445 REM
6450 GOTO 7600:REM WE CAN'T PLAY A CARD SO WILL HAVE TO DRAW ONE
6455 REM
6460 U6=0:IF U=1 THEN TC=X8:TR=7:GOTO 8000
6461 GOSUB 7300:XF=X3:GOSUB 6490:IF U6=0 GOSUB 7400:TC=X8:TR=7:GOTO8000
6462 U5=X8:GOTO 7600
6465 REM
6490 IF PU<4 THEN RETURN
6491 IF Z>45 THEN RETURN
6492 U8=INT(52-Z)/4:U7=0:U6=1:RETURN
6499 REM ROUTINE TO BUILD UP VALUES IN QS
7000 GOSUB 7010:GOSUB 8600:GOSUB 7030:GOSUB 7050:TR=X:TC=X3:RETURN
7005 REM
7010 FOR X=0 TO 3:QS(X)=0:NEXT:FOR TC=0 TO 3:FOR TR=0 TO 12:IF TR=7 THEN 7020
7011 IF T(TR,TC)>0 THEN GOSUB 7025
7020 NEXT:NEXT:RETURN
7025 QS(TC)=QS(TC)+1:RETURN
7029 REM ROUTINE TO FIND HIGHEST CARD
7030 FOR X=12 TO 0 STEP-1:IF X=7 THEN 7040
7031 IF T(X,X3)>0 THEN RETURN
7040 NEXT:RETURN
7049 REM ROUTINE TO DISPLAY PLAYED CARD (CALLED BY LINE 8000)
7050 Q(X3)=Q(X3)+1:XL=T(X,X3):T(X,X3)=0:Y=XL:GOSUB 2550:PRINT@S8/2,"  ";:PRINT@S8/2,CHR$(WS);:Y5=WD:GOSUB 2300:PRINT@S7/2,"  ";:PRINT@S7/2,F:RETURN
7299 REM ROUTINE TO WEIGHT SUIT VALUES
7300 FOR ZZ=0 TO 3:QS(Z1)=0:NEXT:FOR ZZ=0 TO 3:FOR ZY=0 TO 12:GOSUB 7350:NEXT:NEXT:
7301 VS=(Q(0)*5)+(QS(0)*20):VH=(Q(1)*5)+(QS(1)*20):VD=(Q(2)*5)+(QS(2)*20):VC=(Q(3)*5)+(QS(3)*20)
7305 IF QS(0)=0 THEN VS=0
7306 IF QS(1)=0 THEN VH=0
7307 IF QS(2)=0 THEN VD=0
7308 IF QS(3)=0 THEN VC=0
7309 REM DON'T FORCE A SUIT MACHINE IS VOID IN, WHATEVER THE WEIGHTING FACTORS SAY
7310 QS(0)=VS:QS(1)=VH:QS(2)=VD:QS(3)=VC
7320 GOSUB 8600:REM COME BACK WITH THE CORRECT SUIT TO FORCE = X3
7330 RETURN
7350 IF ZY=7 OR T(ZY,ZZ)=0 THEN RETURN
7351 QS(ZZ)=QS(ZZ)+1:RETURN
7399 REM ROUTINE TO PLAY AN 8
7400 IF U=1 THEN PRINT@384/2,"MY LAST CARD'S AN 8";:RETURN
7401 IF X3=0 THEN J$=C5$:GOTO7410
7402 IF X3=1 THEN J$=C6$:GOTO7410
7403 IF X3=2 THEN J$=C7$:GOTO7410
7404 J$=C8$
7410 PRINT@384/2,"I PLAY AN 8-- NEW SUIT IS "J$:PRINT@832/2,"":PRINT@896/2,"press any key";
7411 PRINT@960/2,"";:GOSUB 16000:PRINT@384/2,CHR$(216);:PRINT@896/2,"":PRINT@960/2,C9$;:RETURN
7599 REM ROUTINE TO DRAW CARDS UNTIL PLAYABLE CARD FOUND OR OTHER CONDITIONS MET
7600 IF Z=52 THEN 8500
7601 PRINT@384/2,"";:GOSUB 7700:GOSUB16100:Y=M(Z):Z=Z+1:U7=U7+1:GOSUB 2550
7602 PR1NT@384/2,CHR$(30);:IF Z=47 THEN GOSUB 26000
7603 IF Z=52 THEN GOSUB 10500:REM AT THIS POINT WD=DENOM. AND WS=SUIT
7610 GOSUB 2600:REM TC NOW HAS VALUE FROM 0 TO 3
7620 T(WD-1,TC)=Y: U=U+1:GOSUB 2100:REM DRAWN CARD HAS BEEN STORED IN MACHINE'S HAND
7630 IF WD=8 OR WD-1=PD OR TC=WC THEN 7650:REM 7650 IF IT CAN BE USED AS DISCARD
7640 IF U6=0 THEN 7600
7641 IF U7<=U8 THEN 7600
7642 X3=XF:GOSUB 7400:TC=U5:TR=7:GOTO 8000
7650 IF WD=8 THEN XT=X:TT=TC:GOSUB 7010:X=XT:TC=TT:GOSUB 7300:XF=X3:GOSUB 7400:TR=7:GOTO 8000
7651 TR=WD-1:GOTO 8000:REM NOTE THE SUIT THE MACHINE IS FORCING IF PLAYING AN 8, ELSE JUST PLAY IT
7990 REM ****************************
7995 REM ROUTINES IN LISTING 3 JUMP HERE
8000 PRINT@384/2,"MY DISCARD";:GOSUB 16100:PRINT@384/2,CHR$(216);:S4=0:R6=0
8010 U6=0:X=TR:X3=TC:GOSUB 7050:U=U-1:GOSUB 2100:R=0:IF TR=7 AND U=0 THENPRINT@384/2,"I WIN WITH AN 8";:GOSUB 16200:RETURN
8011 IF TR=7 THEN TC=XF:RETURN
8012 RETURN
8011 REM ****************************
8499 REM ROUTINE CALLED WHEN MACHINE CAN'T PLAY ONE AND PACK IS EMPTY
8500 R6=R6+1:IF R6=2 THEN 19900
8501 PRINT@384/2,"I CAN'T GO: YOUR TURN";:GOSUB 16100:GOSUB 16100:PRINT@384/2,"":R=0:TR=PD:TC=WC:RETURN
8599 REM ROUTINE TO FIND SUIT WITH MOST CARDS IN AND STORE ITS ARRAY COLUMN IN X3
8600 IF QS(0)>=QS(1) THEN X1=0:GOTO8610
8601 X1=1
8610 IF QS(X1)>=QS(2) THEN X2=X1:GOTO8620
8611 X2=2
8620 IF QS(X2)>=QS(3) THEN X3=X2:GOTO8630
8621 X3=3
8630 RETURN
