10 REM ** GAMMA-IG MASTER **
15 DIMM(4,4,2),G(7,1),K(7)
20 CLS:PRINT@0,"*GAMMA-I*:GOSUB550:GOSUB600
25 GOSUB725:IFCO=32THEN35
30 C=C+1:GOSUB200:GOSUB800:IFGF=1THEN40
35 GOSUB400:IFINKEY$="D"THEN20
36 GOTO25
40 GOSUB100:GOTO35
100 REM ** GAMMA-GEN G1 **
105 FORK=0TO7:K(K)=0:FORL=0TO1:G(K,L)=0:NEXTL,K:FORMI=0TO4:FORMJ=TO4:GOSUB175:IFM(MI,MJ,0)<4THEN115
110 K(GP)+1:G(GP,0)=G(GP,0)+M(MI,MJ,1):G(GP,1)+M(MI,MJ,2)
115 NEXTMJ,MI
120 FORGP=0TO7:FORGQ=0TO1
125 IFK(GP)=0THEN145
130 G(GP,GQ)=G(GP,GQ)/K(GP)
135 IFG(GP,GQ)<2THENG(GP,GQ)=1
140 IFG(GP,GQ)>2THENG(GP,GQ)=3
145 NEXTGQ,GP
150 FORMI=0TO4:FORMJ=0TO4:GOSUB175
155 IFM(MI,MJ,0)>1THEN165
160 M(MI,MJ,1)=G(GP,0):M(MI,MJ,2)=G(GP,1):M(MI,MJ,0)=1THENPOKE16327,42:POKE16327,32
165 NEXTMJ,MI
170 POKE16325,32:GF=0:RETURN
175 REM ** GAMMA PHASE-2 **
180 IFMI<2ANDMJ<2THENGP=0
182 IFMI<2ANDMJ=2THENGP=1
184 IFMI<2ANDMJ>2THENGP=2
186 IFMI=2ANDMJ<2THENGP=3
188 IFMI=2ANDMJ>2THENGP=4
190 IFMI>2ANDMJ<2THENGP=5
192 IFMI>2ANDMJ=2THENGP=6
194 IFMI>2ANDMJ>2THENGP=7
196 RETURN
200 REM ** GAMMA CONL G-1 **
205 MI=I+2:MJ=J+2:RI=M(MI,MJ,1):RJ=M(MI,MJ,2):KL=M(MI,MJ,0):IFKL=0THEN235
210 I=RI-2:J=RJ-2:GOSUB725:IFCO=32THEN240
215 C=C+1:IFKL=0THEN235
220 KL=KL-1:IFKL=0THEN235
230 GF=1:GOTO210
235 GOSUB650:KL=1:GOTO210
240 IFKL<4THEN245
241 GOTO255
245 KL=KL+1:IFKL=4THEN250
246 GOTO255
250 GF=1
255 M(MI,MJ,1)=RI:M(MI,MJ,2)=RJ:M(MI,MJ,0)=KL:D=D+1:RETURN
400 POKENP,32:NP=NP+I+64*J:POKENP,140:RETURN
550 REM ** FIELD II-1 **
555 FORF=15553TO15615:POKEF,131:NEXT
560 FORF=16193TO16255:POKEF,176:NEXT
565 FORF=15553TO16255STEP64:POKEF,191:NEXT
570 FORF=15615TO16255STEP64:POKEF,191:NEXT
575 RETURN
600 REM ** INITIAL IIG-1 **
605 NP=15968:GOSUB650:I=RI-2:J=RJ-2:C=0:D=0:RETURN
650 REM ** FETCH NEW IIG-1 **
655 RI=RND(5)-1:RJ=RND(5)-1:IFRI=2ANDRJ=2THEN655
660 RETURN
725 REM ** CON SENSE II-1 **
730 FORSI=ABS(I)TO1STEP-1:FORSJ=ABS(J)TO1STEP-1
735 CO=PEEK(NP+SI*SGN(I)+64*SJ*SGN(J))
740 IFCO<>32THENRETURN
745 NEXTSJ,SI:RETURN
800 REM ** UD SCORE IIG-1 **
810 PRINT@0,"CONTACTS      MOVES       SC";
815 PRINT@9,C;:PRINT@20,D;:PRINT@29,MID$(STR$(D),2,3);
820 RETURN
