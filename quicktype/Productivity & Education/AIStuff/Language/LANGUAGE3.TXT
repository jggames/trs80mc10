0 DIMCC,ZZ:GOTO10

8 ZZ=SGN(CC)-W:RETURN:REM FN KM
9 ZZ=W-SGN(CC-W):RETURN:REM FN KP

10 CLS:PRINT"LANGUAGE":INPUT"INPUT THRESHOLD (DEFAULT=0)";TR
11 B1=1.184015211:B2=.800417167:B3=18.43103375:B4=.112255309:B5=1.625639319:B6=1.476639897:HF=.5
12 PRINT"DO YOU WANT RECOGNITION ROUTINE":INPUT"(Y/N)";RR$
20 W=1:XT=W:TW=2:TH=3:T=100:TT=1000:ML=TW:HI=W:HJ=W:TC=TT:TY=36:C1=B1+B2+B5:C2=TW*(B1+B2):T3=TT
30 REM S$() HOLDS THE I/P STRING, L$() HOLDS THE LEXICON. PL() HOLDS LEXCON FREQUENCIES.
40 REM THIS SECTION TAKES IN THE I/P STRING AND BUILDS UP A LEXICON AND FREQUENCY COUNT
50 DIM S$(1000),L$(T),PL(T),L(T,T),X(TT),I(T),B(30,TY),KF(TY)
60 PRINT"HOW MANY CHARACTERS ARE YOU":INPUT"ENTERING AT A TIME";SC
61 INPUT"DO YOU HOLD THE CHARACTERS ON TAPE (Y/N)";A$
62 IFA$="Y"THEN:PRINT"RECALL X":STOP:FORI=WTOSC:S$(I)=CHR$(X(I)):PRINTS$(I);:NEXT:FORI=SC+WTOTT:S$(I)=CHR$(X(I)):NEXT:GOTO95
80 FORI=WTOSC
81 M$=INKEY$:IFM$=""THEN81
82 S$(I)=M$:X(I)=ASC(M$):IFX(I)=8THENI=I-W:S$(I)="":PRINT:PRINT:FORJ=WTOI-W:PRINTS$(J);:NEXT:GOTO80
90 PRINTS$(I);:NEXT
91 PRINT:PRINT"DO YOU WISH TO STORE THESE":INPUT"CHARACTERS ON TAPE (Y/N)";A$
92 IFA$="Y"THENPRINT"STORE X":STOP
94 REM THE NEXT SECTION SETS UP L(I,J) AS A JOINT PROBABILITY MATRIX.
95 HI=Z:FORI=WTOSC
110 FORJ=ZTOLC
120 IFS$(I)<>L$(J)THENNEXT
130 PL(J)=INT(PL(J)+W):IFJ=LC+WTHENLC=LC+W:L$(LC)=S$(I):REM J?
140 IFHITHENL(HI,J)=INT(L(HI,J)+W):CC=L(HI,J):GOSUB9:L(HI,Z)=INT(L(HI,Z)+ZZ):CC=L(HI,J):GOSUB9:L(Z,J)=INT(L(Z,J)+ZZ)
150 HI=J:NEXT I:PRINT
160 HI=W:HJ=W:GOSUB700:GOSUB800
326 NX=SC-W:SL=LC+LC+(LC+W)/TW:NC=Z:FORI=WTOLC:I(I)=1:NC=NC+L(I,Z):NEXT
329 FORI=TWTOLC:C=W:CC=I(I-W)
330 IFPL(I)=INT(PL(I-W))THENCC=CC+I(I):C=C+N:I=I+W:IFI<=LCTHEN330
331 IFC>WTHENFORJ=I-CTOI-W:I(J)=CC/C:NEXT
332 NEXT:D3=LC+HF:D1=B3/SL:D2=B4/SL:HH=TR-C1*LOG(NC)+C2*LOG(LC)*B5*LOG(NX)+B6:H=HH
333 FORI=WTOLC:FA=B1+LOG(D3-L(I,J))+D1*I(I):FORJ=WTOLC
334 IFL(I,J)THENFF=FA+B2*LOG(D3-L(Z,J))+D2*I(J)+B5*LOG(L(I,J)):IFFF>HHTHENHI=I:HJ=J:HH=FF
340 NEXT:NEXT:IFHH>HTHEN367
345 IFRR$="Y"THENGOSUB2000:HI=W:HJ=W:GOSUB700:GOTO326
347 HA=L(HI,HJ):HB=PL(HI)-HA:HC=PL(HJ)-HA:H=HH-H+TR:PRINT"COEFFICIENT FF=";H
349 PRINT"LEXICON ADDITION IS :":L$(HI)+L$(HJ)
370 LC=LC+W:L$(LC)=L$(HI)+L$(HJ)
465 IFLEN(L$(LC))>MLTHENML=LEN(L$(L,C))
490 I=W
500 IW=I+W:IFS$(I)-S$(IW)=L$(LC)THENS$(I)=L$(LC):FORJ=IWTOSC-W:S$(J)-S$(J+W):NEXT:GOSUB900:SC=SC-W
510 PRINTS$(I);" ";
520 I=IW:IFI<SCTHEN500
530 IFI=SCTHENPRINTS$(I)
534 TC=TC-HA:FORI=SC+WTOTC:S$(I)=S$(I+HA):NEXT
540 PL(LC)=INT(PL(LC)+HA):L(HI,HJ)=INT(Z):PL(HI)=PL(HI)-PL(LC)
541 PL(HJ)=PL(HJ)-PL(LC):L(HI,Z)=INT(-L(HI,Z)-W):L(Z,HJ)=INT(L(Z,HJ)-W)
550 PRINT:PRINT"SC=";SC
555 GOSUB700:GOSUB800
570 GOTO326
700 REM SORT ROUTINE
710 IFHJ<HITHENHI=HJ
715 FORI=WTOLC-HI:C=Z
720 FORJ=HITOLC-I:JW=J+W
730 IFPL(J)<PL(JW)THEN740
731 GOTO750
740 H=PL(J):PL(J)=PL(JW):PL(JW)=INT(H):A$=L$(J):L$(J)=L$(JW):L$(JW)=A$
741 FORK=ZTOLC:H=L(K,J):L(K,J)=L(K,JW):L(K,JW)=INT(H):NEXT
742 FORK=ZTOLC:H=L(J,K):L(J,K)=L(JW,K):L(JW,K)=INT(H):NEXT:C=C+W
750 NEXT:IFCTHENNEXT
760 IFPL(LC)=.THENL$(LC)="":LC=LC-W:GOTO760
770 RETURN
800 REM PRINTLEXICON ROUTINE.
810 PRINT"LEXICON =";LC
820 PRINT"I","L$(I)";"  FREQUENCY-PL(I)"
830 FORI=WTOLC
840 PRINTI,L$(I),PL(I)
850 NEXT:RETURN
900 REM:READJUST L(I,J) ROUTINE.
910 C=TW:FORK=WTOLC
920 IFS$(I-W)=L$(K)THEN922
921 GOTO925
922 L(K,LC)=INT(L(K,LC)+W):L(K,HI)=INT(L(K,HI)-W):C=C-W
923 CC=L(K,LC):GOSUB9:A=ZZ:CC=L(K,HI):GOSUB8:B=ZZ:L(K,Z)=INT(L(K,Z)+A)
924 L(Z,LC)=INT(L(Z,LC)+A):L(K,Z)=INT(L(K,Z)+B):L(Z,HI)=INT(L(Z,HI)+B)
925 IFIW=SCTHENNEXT:RETURN
930 IFS$(IW)=L$(K) THEN935
931 GOTO940
935 L(LC,K)=INT(L(LC,K)+W):L(HJ,K)=INT(L(HJ,K)-W):C=C-W:CC=L(LC,K):GOSUB9:A=ZZ
936 CC=L(HJ,K):GOSUB8:B=ZZ:L(LC,Z)=INT(L(LC,Z)+A):L(Z,K)=INT(L(Z,K)+A):L(HJ,Z)=INT(L(HJ,Z)+B):L(Z,K)=INT(L(Z,K)+B)
940 IFCTHENNEXT
950 RETURN


2000 A$="":PRINT"STRING I/P TO RECOGNISER:-"
2030 FORI=SCTOSC-ML+WSTEP-W
2040 A$=S$(I)=A$:IFLEN(A$)<ML-WTHENNEXT
2045 MS=I:NN=SC-MS+ML
2050 J=Z:PRINT
2060 FORI=MS-WTOSC+ML-W
2062 FORK=WTOLC
2066 IFS(I)<>L$(K)THENNEXT
2068 B(J,Z)=K:IFK=LC+WTHENLC=LC+W:L$(LC)=S$(I)
2070 IFJ>ZTHENPRINTL$(K);" ";:IFI<=SCTHENGOSUB5000
2080 IFI>SCTHENA$=A$+L$(K)
2090 K1=K:J=J+W:NEXT I
2200 PRINT:MI=J-W
2210 X$=A$:J=W:K=W:L0=LEN(A$):TK=W:KOR I=WTOTY:KF(I)=INT(L0):NEXT
2220 CO=Z:FORI=WTOLC
2235 IFLI(1)<>LEFT$=(X$,LEN(L$(I)))THENNEXT:GOTO2270
2240 CO=CO+W:IFCO=WTHENB(Z,K)=INT(J):B(J,K)=INT(I):KF(K)=KF(K)-LEN(L$(I))
2242 IFCO <=WTHENNEXT:GOTO2270
2245 TK=TK+W:FORQ=WTOJ-W:B(Q,TK)=B(Q,K):NEXT:B(J,TK)=INT(I):KF(TK)=KF(K)-LEN(L$(I))+LEN(L$(B(J,K))):B(Z,TK)=INT(J)
2249 IFTK>MKTHENMK=TK
2250 NEXT
2270 IFTK>WTHENGOSUB2500:IFFLTHEN2380
2350 L1=L0:FORK=WTOTK:IFKF(K)>ZANDKF(K)<=L1THENL1=KF(K):KH=K
2370 NEXT:IFL1 AND KF(KH)THENK=KH:X$=RIGHT$(A$,L1):J=B(Z,K)+W:GOTO2220
2380 TI=TK:IFTK=WTHENOP=W:GOTO2600
2400 HH=TT+TW:FORI=WTOTK:E=Z:CH=Z:FORJ=WTOMI:E=Z:E=E+PL(B(J,I)):NEXT:E=E/MI:FORJ=WTOMI:CH=CH+((PL(B(J,I))-E)+TW)/E:NEXT:IFCH<HHTHENOP=I:HH=CH
2440 NEXT:GOTO2600

2500 FL=0:REM RECOGNISER SHRINK
2502 FORI=WTOTK:IFKF(I)=ZANDB(Z,I)<MITHENMI=B(Z,I)
2504 NEXT
2510 FORI=WTOTK
2520 IFB(Z,I)>MI OR B(Z,I)=MIANDKF(I)THENFORQ=ZTOB(Z,TK):B(Q,I)=B(Q,TK):NEXT:KF(I)=KF(TK):TK=TK-W:I=I-W
2523 IFI=TKTHEN2530
2525 NEXT
2530 FORI=WTOTK:IFKF(I)THENRETURN
2540 NEXT:FL=1:RETURN

2600 REM PRINT CHOSEN OPTION (S) AND THEN INTO 3000
2610 PRINT"RECOGNISER GIVES:-":PRINT:FORI=WTOB(Z,OP):PRINTL$(B(OP));" "1:NEXT:PRINT
2620 IFTI>WTHENPRINT"TIE-BREAKER":STOP
3000 REM ROUTINETOTAKE ON MORE INPUT
3020 SC=SC-NN+ML-W+B(Z,OP)
3060 FORI=WTOB(Z,OP)
3070 PL(B(I,OP))=INT(PL(B(I,OP))+W)
3060 NEXT
3090 A=B(Z,Z):B=B(W,OP)
3120 L(A,B)=INT(L(A,B)+W):CC=L(A,B):GOSUB9:L(A,Z)=L(A,Z)+ZZ:CC=L(A,B):GOSUB9:L(Z,B)=L(Z,B)+ZZ
3125 IFB(Z,OP)<=WTHEN3160
3130 FORI=WTOB(Z,OP)-W
3132 A=B(I,OP):B=B(I+W,OP)
3140 L(A,B)=INT(L(A,B)+W):CC=L(A,B):GOSUB9:L(A,Z)=L(A,Z)+ZZ:CC=L(A,B):GOSUB9:L(Z,B)=L(Z,B)+ZZ
3150 NEXT
3160 DI=NN-B(Z,OP):TC=TC-DI:IFDI<ZTHENFORI=TCTOSC+WSTEP-W:S$(I)=S$(I+DI):NEXT
3165 J=W
3170 FORI=SC-B(Z,OP)+WTOSC
3180 S$(I)=L$(B(J,OP)):J=J+W
3190 NEXT
3200 IFDI>ZTHENFORI=SC+WTOTC:S$(I)=S$(I+DI):NEXT
3220 RETURN
5000 PL(K)=INT(PL(K)-W):L(K1,K)=INT(L(K1,K)-W):CC=L(K1,K):GOSUB8:L(K1,Z)=L(K1,Z)+ZZ
5010 CC=L(K1,K):GOSUB8:L(Z,K)=L(Z,K)+ZZ:RETURN
